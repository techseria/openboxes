{"code":"(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{238:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=a(1),s=S(r),o=a(25),l=S(a(0)),u=S(a(243)),c=a(14),d=S(a(465)),f=S(a(471)),p=S(a(535)),m=S(a(537)),h=S(a(539)),b=S(a(541)),v=S(a(544)),y=S(a(12)),g=a(52),k=a(88);function S(e){return e&&e.__esModule?e:{default:e}}var M=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.dataFetched=!1,console.log(\"stockpage\"),a.state={page:1,prevPage:1,values:a.props.initialValues},a.nextPage=a.nextPage.bind(a),a.previousPage=a.previousPage.bind(a),a.goToPage=a.goToPage.bind(a),a.setValues=a.setValues.bind(a),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.Component),i(t,[{key:\"componentDidMount\",value:function(){this.props.fetchTranslations(\"\",\"stockMovement\"),this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchInitialValues())}},{key:\"componentWillReceiveProps\",value:function(e){this.props.locale&&this.props.locale!==e.locale&&this.props.fetchTranslations(e.locale,\"stockMovement\"),e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchInitialValues())}},{key:\"getStepList\",value:function(){return[this.props.translate(\"react.stockMovement.create.label\",\"Create\"),this.props.translate(\"react.stockMovement.addItems.label\",\"Add items\"),this.props.translate(\"react.stockMovement.edit.label\",\"Edit\"),this.props.translate(\"react.stockMovement.pick.label\",\"Pick\"),this.props.translate(\"react.stockMovement.pack.label\",\"Pack\"),this.props.translate(\"react.stockMovement.send.label\",\"Send\")]}},{key:\"getFormList\",value:function(){return[s.default.createElement(d.default,{initialValues:this.state.values,onSubmit:this.nextPage}),s.default.createElement(f.default,{initialValues:this.state.values,previousPage:this.previousPage,goToPage:this.goToPage,onSubmit:this.nextPage}),s.default.createElement(p.default,{initialValues:this.state.values,previousPage:this.previousPage,onSubmit:this.nextPage}),s.default.createElement(m.default,{initialValues:this.state.values,previousPage:this.previousPage,onSubmit:this.nextPage}),s.default.createElement(h.default,{initialValues:this.state.values,previousPage:this.previousPage,onSubmit:this.nextPage}),s.default.createElement(b.default,{initialValues:this.state.values,previousPage:this.previousPage,setValues:this.setValues})]}},{key:\"setValues\",value:function(e){this.setState({values:e})}},{key:\"getShipmentName\",value:function(){if(this.state.values.trackingNumber){var e=this.state.values,t=e.origin,a=e.destination,n=e.dateRequested,i=e.stocklist,r=e.trackingNumber,s=e.description,o=i&&i.name?i.name+\".\":\"\",l=(0,u.default)(n,\"MM/DD/YYYY\").format(\"DDMMMYYYY\");return(t.name+\".\"+a.name+\".\"+l+\".\"+o+r+\".\"+s).replace(/ /gi,\"\")}return this.state.values.name}},{key:\"fetchInitialValues\",value:function(){var e=this;if(this.props.match.params.stockMovementId){this.props.showSpinner();var t=\"/openboxes/api/stockMovements/\"+this.props.match.params.stockMovementId;y.default.get(t).then(function(t){var a=t.data.data,i=a.origin.locationType,r=a.destination.locationType,s=n({},a,{stockMovementId:a.id,movementNumber:a.identifier,origin:{id:a.origin.id,type:i?i.locationTypeCode:null,name:a.origin.name,label:a.origin.name+\" [\"+(i?i.description:null)+\"]\"},destination:{id:a.destination.id,type:r?r.locationTypeCode:null,name:a.destination.name,label:a.destination.name+\" [\"+(r?r.description:null)+\"]\"},requestedBy:{id:a.requestedBy.id,name:a.requestedBy.name,label:a.requestedBy.name}}),o=1,l=1;switch(s.statusCode){case\"CREATED\":o=2,l=1;break;case\"VERIFYING\":o=3,l=2;break;case\"PICKING\":o=4,l=3;break;case\"PICKED\":o=5,l=4;break;default:o=6,l=\"SUPPLIER\"===s.origin.type?2:5}e.setState({values:s,page:o,prevPage:l})}).catch(function(){return e.props.hideSpinner()})}}},{key:\"nextPage\",value:function(e){this.setState({prevPage:this.state.page,page:this.state.page+1,values:e})}},{key:\"previousPage\",value:function(e){this.setState({prevPage:this.state.prevPage-1,page:this.state.prevPage,values:e})}},{key:\"goToPage\",value:function(e,t){this.setState({prevPage:this.state.page,page:e,values:t})}},{key:\"render\",value:function(){var e=this.state,t=e.page,a=e.values,n=this.getFormList(),i=this.getStepList();return s.default.createElement(\"div\",null,s.default.createElement(\"div\",null,s.default.createElement(v.default,{steps:i,currentStep:t})),s.default.createElement(\"div\",{className:\"panel panel-primary\"},s.default.createElement(\"div\",{className:\"panel-heading movement-number\"},a.movementNumber&&a.name&&!a.trackingNumber&&s.default.createElement(\"span\",null,a.movementNumber+\" - \"+a.name),a.trackingNumber&&s.default.createElement(\"span\",null,a.movementNumber+\" - \"+this.getShipmentName())),s.default.createElement(\"div\",{className:\"panelBody px-1\"},n[t-1])))}}]),t}();t.default=(0,o.connect)(function(e){return{locale:e.session.activeLanguage,stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement,translate:(0,k.translateWithDefaultMessage)((0,c.getTranslate)(e.localize))}},{showSpinner:g.showSpinner,hideSpinner:g.hideSpinner,fetchTranslations:g.fetchTranslations})(M),M.propTypes={match:l.default.shape({params:l.default.shape({stockMovementId:l.default.string})}).isRequired,showSpinner:l.default.func.isRequired,hideSpinner:l.default.func.isRequired,initialValues:l.default.shape({}),locale:l.default.string.isRequired,stockMovementTranslationsFetched:l.default.bool.isRequired,fetchTranslations:l.default.func.isRequired,translate:l.default.func.isRequired},M.defaultProps={initialValues:{}}},313:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=o(a(1)),r=o(a(0)),s=o(a(88));function o(e){return e&&e.__esModule?e:{default:e}}var l=function(e){var t=e.fieldName,a=e.fieldConfig,r=a.buttonLabel,o=a.buttonDefaultMessage,l=a.getDynamicAttr,u=a.attributes,c=void 0===u?{className:\"btn-outline-primary\"}:u,d=l?l(e):{},f=n({},c,d);return i.default.createElement(\"button\",n({type:\"button\",key:t},f,{className:\"btn btn-xs \"+f.className}),\"string\"==typeof r?i.default.createElement(s.default,{id:r,defaultMessage:o}):i.default.createElement(r,null))};t.default=l,l.propTypes={fieldName:r.default.string.isRequired,fieldConfig:r.default.shape({getDynamicAttr:r.default.func}).isRequired}},465:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=q(a(13)),s=a(1),o=q(s),l=a(25),u=q(a(0)),c=a(253),d=a(54),f=a(89),p=q(a(102)),m=a(14);a(256);var h=q(a(243)),b=q(a(254)),v=q(a(255)),y=q(a(275)),g=a(250),k=q(a(12)),S=a(52),M=a(92),I=a(88),E=q(I);function q(e){return e&&e.__esModule?e:{default:e}}function P(e){console.log(\"stockpage\");var t={};if(e.description||(t.description=\"react.default.error.requiredField.label\"),e.origin||(t.origin=\"react.default.error.requiredField.label\"),e.destination||(t.destination=\"react.default.error.requiredField.label\"),e.requestedBy||(t.requestedBy=\"react.default.error.requiredField.label\"),e.dateRequested){var a=(0,h.default)(e.dateRequested,\"MM/DD/YYYY\");(0,h.default)().diff(a)<0&&(t.dateRequested=\"react.stockMovement.error.futureDate.label\")}else t.dateRequested=\"react.default.error.requiredField.label\";return t}var x={description:{type:b.default,label:\"react.stockMovement.description.label\",defaultMessage:\"Description\",attributes:{required:!0,autoFocus:!0}},origin:{type:v.default,label:\"react.stockMovement.origin.label\",defaultMessage:\"Origin\",attributes:{required:!0,async:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],filterOptions:function(e){return e}},getDynamicAttr:function(e){return{loadOptions:e.debouncedLocationsFetch,onChange:function(t){t&&e.destination&&e.destination.id&&e.fetchStockLists(t,e.destination)},disabled:\"OUTBOUND\"===p.default.parse(window.location.search).direction&&!e.isSuperuser}}},destination:{type:v.default,label:\"react.stockMovement.destination.label\",defaultMessage:\"Destination\",attributes:{required:!0,async:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],filterOptions:function(e){return e}},getDynamicAttr:function(e){return{loadOptions:e.debouncedLocationsFetch,onChange:function(t){t&&e.origin&&e.origin.id&&e.fetchStockLists(e.origin,t)},disabled:\"INBOUND\"===p.default.parse(window.location.search).direction&&!e.isSuperuser}}},stocklist:{label:\"react.stockMovement.stocklist.label\",defaultMessage:\"Stocklist\",type:v.default,getDynamicAttr:function(e){var t=e.origin,a=e.destination,n=e.stocklists;return{disabled:!(t&&a&&t.id&&a.id),options:n,showValueTooltip:!0,objectValue:!0}}},requestedBy:{type:v.default,label:\"react.stockMovement.requestedBy.label\",defaultMessage:\"Requested by\",attributes:{async:!0,required:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],labelKey:\"name\",filterOptions:function(e){return e}},getDynamicAttr:function(e){return{loadOptions:e.debouncedUsersFetch}}},dateRequested:{type:y.default,label:\"react.stockMovement.dateRequested.label\",defaultMessage:\"Date requested\",attributes:{required:!0,dateFormat:\"MM/DD/YYYY\",autoComplete:\"off\"}}},w=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.state={stocklists:[],setInitialLocations:!0,values:a.props.initialValues},a.fetchStockLists=a.fetchStockLists.bind(a),a.debouncedUsersFetch=(0,M.debounceUsersFetch)(a.props.debounceTime,a.props.minSearchLength),a.debouncedLocationsFetch=(0,M.debounceLocationsFetch)(a.props.debounceTime,a.props.minSearchLength),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),i(t,[{key:\"componentDidMount\",value:function(){this.state.values.origin&&this.state.values.destination&&this.fetchStockLists(this.state.values.origin,this.state.values.destination)}},{key:\"componentWillReceiveProps\",value:function(e){!this.props.match.params.stockMovementId&&this.state.setInitialLocations&&e.location.id&&this.setInitialLocations(e.location)}},{key:\"setInitialLocations\",value:function(e){var t=e.id,a=e.locationType,n=e.name;if(\"INBOUND\"===p.default.parse(window.location.search).direction){var i={destination:{id:t,type:a?a.locationTypeCode:null,name:n,label:n+\" [\"+(a?a.description:null)+\"]\"}};this.setState({values:i,setInitialLocations:!1})}if(\"OUTBOUND\"===p.default.parse(window.location.search).direction){var r={origin:{id:t,type:a?a.locationTypeCode:null,name:n,label:n+\" [\"+(a?a.description:null)+\"]\"}};this.setState({values:r,setInitialLocations:!1})}}},{key:\"checkStockMovementChange\",value:function(e){var t=this.props.initialValues,a=t.origin,n=t.destination,i=t.stocklist,s=e.origin&&a,o=a&&\"SUPPLIER\"===a.type,l=e.origin&&\"SUPPLIER\"===e.type,u=!(!s||o&&(!o||l))&&e.origin.id!==a.id,c=!!(i&&e.destination&&n)&&e.destination.id!==n.id,d=!!e.stockMovementId&&r.default.get(e.stocklist,\"id\",null)!==r.default.get(i,\"id\",null);return u||c||d}},{key:\"fetchStockLists\",value:function(e,t,a){var n=this;this.props.showSpinner();var i=\"/openboxes/api/stocklists?origin.id=\"+e.id+\"&destination.id=\"+t.id;return console.log(i),k.default.get(i).then(function(e){var t=r.default.map(e.data.data,function(e){return{value:{id:e.id,name:e.name},label:e.name}});!r.default.find(t,function(e){return e.value.id===r.default.get(n.state.values,\"stocklist.id\")})&&a&&a(),n.setState({stocklists:t}),n.props.hideSpinner()}).catch(function(){return n.props.hideSpinner()})}},{key:\"saveStockMovement\",value:function(e){var t=this;if(e.origin&&e.destination&&e.requestedBy&&e.dateRequested&&e.description){this.props.showSpinner();var a=\"\";a=e.stockMovementId?\"/openboxes/api/stockMovements/\"+e.stockMovementId+\"/updateRequisition\":\"/openboxes/api/stockMovements\",console.log(e.description),console.log(e.origin.id),console.log(e.dateRequested),console.log(e.requestedBy);var i={name:\"\",description:e.description,dateRequested:e.dateRequested,origin:e.origin,destination:e.destination,requestedBy:e.requestedBy,stocklist:r.default.get(e.stocklist,\"id\")||\"\"};console.log(i),k.default.post(a,i).then(function(a){if(a.data){var i=a.data.data;t.props.history.push(\"/openboxes/stockMovement/create/\"+i.id),t.props.onSubmit(n({},e,{stockMovementId:i.id,lineItems:i.lineItems,movementNumber:i.identifier,name:i.name,stocklist:i.stocklist}))}}).catch(function(){return t.props.hideSpinner(),Promise.reject(new Error(t.props.translate(\"react.stockMovement.error.createStockMovement.label\",\"Could not create stock movement\")))})}}},{key:\"resetToInitialValues\",value:function(){var e=this;this.setState({values:{}},function(){return e.setState({values:e.props.initialValues})})}},{key:\"nextPage\",value:function(e){var t=this;this.checkStockMovementChange(e)?(0,f.confirmAlert)({title:this.props.translate(\"react.stockMovement.message.confirmChange.label\",\"Confirm change\"),message:this.props.translate(\"react.stockMovement.confirmChange.message\",\"Do you want to change stock movement data? Changing origin, destination or stock list can cause loss of your current work\"),buttons:[{label:this.props.translate(\"react.default.no.label\",\"No\"),onClick:function(){return t.resetToInitialValues()}},{label:this.props.translate(\"react.default.yes.label\",\"Yes\"),onClick:function(){return t.saveStockMovement(e)}}]}):this.saveStockMovement(e)}},{key:\"render\",value:function(){var e=this;return o.default.createElement(c.Form,{onSubmit:function(t){return e.nextPage(t)},validate:P,initialValues:this.state.values,mutators:{clearStocklist:function(e,t,a){a.changeValue(t,\"stocklist\",function(){return null})}},render:function(t){var a=t.form.mutators,n=t.handleSubmit,i=t.values;return o.default.createElement(\"form\",{className:\"create-form\",onSubmit:n},r.default.map(x,function(t,n){return(0,g.renderFormField)(t,n,{stocklists:e.state.stocklists,fetchStockLists:function(t,n){return e.fetchStockLists(t,n,a.clearStocklist)},origin:i.origin,destination:i.destination,isSuperuser:e.props.isSuperuser,debouncedUsersFetch:e.debouncedUsersFetch,debouncedLocationsFetch:e.debouncedLocationsFetch})}),o.default.createElement(\"div\",null,o.default.createElement(\"button\",{type:\"submit\",className:\"btn btn-outline-primary float-right btn-xs\"},o.default.createElement(E.default,{id:\"react.default.button.next.label\",defaultMessage:\"Next\"}))))}})}}]),t}();t.default=(0,d.withRouter)((0,l.connect)(function(e){return{location:e.session.currentLocation,isSuperuser:e.session.isSuperuser,translate:(0,I.translateWithDefaultMessage)((0,m.getTranslate)(e.localize)),debounceTime:e.session.searchConfig.debounceTime,minSearchLength:e.session.searchConfig.minSearchLength}},{showSpinner:S.showSpinner,hideSpinner:S.hideSpinner})(w)),w.propTypes={match:u.default.shape({params:u.default.shape({stockMovementId:u.default.string})}).isRequired,initialValues:u.default.shape({origin:u.default.shape({id:u.default.string}),destination:u.default.shape({id:u.default.string}),stocklist:u.default.shape({})}).isRequired,showSpinner:u.default.func.isRequired,hideSpinner:u.default.func.isRequired,onSubmit:u.default.func.isRequired,history:u.default.shape({push:u.default.func}).isRequired,location:u.default.shape({name:u.default.string,id:u.default.string,locationType:u.default.shape({description:u.default.string,locationTypeCode:u.default.string})}).isRequired,isSuperuser:u.default.bool.isRequired,translate:u.default.func.isRequired,debounceTime:u.default.number.isRequired,minSearchLength:u.default.number.isRequired}},471:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=w(a(13)),s=a(1),o=w(s),l=a(25),u=w(a(0)),c=w(a(276)),d=a(253),f=w(a(264)),p=w(a(53)),m=a(89),h=a(14);a(256);var b=w(a(254)),v=w(a(255)),y=w(a(257)),g=w(a(313)),k=w(a(261)),S=w(a(275)),M=a(250),I=a(52),E=w(a(12)),q=a(88),P=w(q),x=a(92);function w(e){return e&&e.__esModule?e:{default:e}}var C={type:g.default,label:\"react.default.button.delete.label\",defaultMessage:\"Delete\",flexWidth:\"1\",fieldKey:\"\",buttonLabel:\"react.default.button.delete.label\",buttonDefaultMessage:\"Delete\",getDynamicAttr:function(e){var t=e.fieldValue,a=e.removeItem,n=e.removeRow;return{onClick:t.id?function(){return a(t.id).then(function(){return n()})}:n,disabled:\"SUBSTITUTED\"===t.statusCode}},attributes:{className:\"btn btn-outline-danger\"}},R={lineItems:{type:y.default,virtualized:!0,arrowsNavigation:!0,addButton:function(e){var t=e.addRow,a=e.getSortOrder;return o.default.createElement(\"button\",{type:\"button\",className:\"btn btn-outline-success btn-xs\",onClick:function(){return t({sortOrder:a()})}},o.default.createElement(P.default,{id:\"react.default.button.addLine.label\",defaultMessage:\"Add line\"}))},fields:{product:{fieldKey:\"disabled\",type:v.default,label:\"react.stockMovement.requisitionItems.label\",defaultMessage:\"Requisition items\",flexWidth:\"9.5\",attributes:{async:!0,openOnClick:!1,autoload:!1,filterOptions:function(e){return e},cache:!1,options:[],showValueTooltip:!0,className:\"text-left\"},getDynamicAttr:function(e){return{disabled:!!e.fieldValue,loadOptions:e.debouncedProductsFetch,autoFocus:e.rowIndex===e.rowCount-1}}},quantityRequested:{type:b.default,label:\"react.stockMovement.quantity.label\",defaultMessage:\"Quantity\",flexWidth:\"2.5\",attributes:{type:\"number\"},fieldKey:\"\",getDynamicAttr:function(e){var t=e.fieldValue;return{disabled:\"SUBSTITUTED\"===t.statusCode||r.default.isNil(t.product)}}},recipient:{type:v.default,label:\"react.stockMovement.recipient.label\",defaultMessage:\"Recipient\",flexWidth:\"2.5\",fieldKey:\"\",getDynamicAttr:function(e){var t=e.fieldValue,a=e.recipients,n=e.addRow,i=e.rowCount,s=e.rowIndex,o=e.getSortOrder;return{options:a,disabled:\"SUBSTITUTED\"===t.statusCode||r.default.isNil(t.product),onTabPress:i===s+1?function(){return n({sortOrder:o()})}:null,arrowRight:i===s+1?function(){return n({sortOrder:o()})}:null,arrowDown:i===s+1?function(){return n({sortOrder:o()})}:null}},attributes:{labelKey:\"name\",openOnClick:!1}},deleteButton:C}}},N={lineItems:{type:y.default,virtualized:!0,arrowsNavigation:!0,addButton:function(e){var t=e.addRow,a=e.getSortOrder,n=e.newItemAdded;return o.default.createElement(\"button\",{type:\"button\",className:\"btn btn-outline-success btn-xs\",onClick:function(){t({sortOrder:a()}),n()}},o.default.createElement(P.default,{id:\"react.default.button.addLine.label\",defaultMessage:\"Add line\"}))},fields:{product:{fieldKey:\"disabled\",type:v.default,label:\"react.stockMovement.requisitionItems.label\",defaultMessage:\"Requisition items\",flexWidth:\"9\",attributes:{async:!0,openOnClick:!1,autoload:!1,filterOptions:function(e){return e},cache:!1,options:[],showValueTooltip:!0,className:\"text-left\"},getDynamicAttr:function(e){var t=e.fieldValue,a=e.debouncedProductsFetch,n=e.rowIndex,i=e.rowCount;return{disabled:!!t,loadOptions:a,autoFocus:e.newItem&&n===i-1}}},quantityAllowed:{type:k.default,label:\"react.stockMovement.maxQuantity.label\",defaultMessage:\"Max Qty\",flexWidth:\"1.7\",attributes:{type:\"number\"}},quantityRequested:{type:b.default,label:\"react.stockMovement.neededQuantity.label\",defaultMessage:\"Needed Qty\",flexWidth:\"1.7\",attributes:{type:\"number\"},getDynamicAttr:function(e){var t=e.addRow,a=e.rowCount,n=e.rowIndex,i=e.getSortOrder;return{onTabPress:a===n+1?function(){return t({sortOrder:i()})}:null,arrowRight:a===n+1?function(){return t({sortOrder:i()})}:null,arrowDown:a===n+1?function(){return t({sortOrder:i()})}:null}}},deleteButton:C}}},T={lineItems:{type:y.default,virtualized:!0,arrowsNavigation:!0,addButton:function(e){var t=e.addRow,a=e.getSortOrder;return o.default.createElement(\"button\",{type:\"button\",className:\"btn btn-outline-success btn-xs\",onClick:function(){return t({sortOrder:a()})}},o.default.createElement(P.default,{id:\"react.default.button.addLine.label\",defaultMessage:\"Add line\"}))},fields:{palletName:{type:b.default,label:\"react.stockMovement.pallet.label\",defaultMessage:\"Pallet\",flexWidth:\"1\",getDynamicAttr:function(e){return{autoFocus:e.rowIndex===e.rowCount-1}}},boxName:{type:b.default,label:\"react.stockMovement.box.label\",defaultMessage:\"Box\",flexWidth:\"1\"},product:{type:v.default,label:\"react.stockMovement.item.label\",defaultMessage:\"Item\",flexWidth:\"4\",required:!0,attributes:{className:\"text-left\",async:!0,openOnClick:!1,autoload:!1,filterOptions:function(e){return e},cache:!1,options:[],showValueTooltip:!0},getDynamicAttr:function(e){return{loadOptions:e.debouncedProductsFetch}}},lotNumber:{type:b.default,label:\"react.stockMovement.lot.label\",defaultMessage:\"Lot\",flexWidth:\"1\"},expirationDate:{type:S.default,label:\"react.stockMovement.expiry.label\",defaultMessage:\"Expiry\",flexWidth:\"1.5\",attributes:{dateFormat:\"MM/DD/YYYY\",autoComplete:\"off\",placeholderText:\"MM/DD/YYYY\"}},quantityRequested:{type:b.default,label:\"react.stockMovement.quantity.label\",defaultMessage:\"Qty\",flexWidth:\"1\",required:!0,attributes:{type:\"number\"}},recipient:{type:v.default,label:\"react.stockMovement.recipient.label\",defaultMessage:\"Recipient\",flexWidth:\"1.5\",getDynamicAttr:function(e){var t=e.recipients,a=e.addRow,n=e.rowCount,i=e.rowIndex,r=e.getSortOrder;return{options:t,onTabPress:n===i+1?function(){return a({sortOrder:r()})}:null,arrowRight:n===i+1?function(){return a({sortOrder:r()})}:null,arrowDown:n===i+1?function(){return a({sortOrder:r()})}:null}},attributes:{labelKey:\"name\",openOnClick:!1}},deleteButton:C}}};function O(e){var t={lineItems:[]};return r.default.forEach(e.lineItems,function(e,a){r.default.isNil(e.product)||e.quantityRequested&&!(e.quantityRequested<0)||(t.lineItems[a]={quantityRequested:\"react.stockMovement.error.enterQuantity.label\"})}),t}var D=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.dataFetched=!1,a.state={currentLineItems:[],sortOrder:0,values:a.props.initialValues,newItem:!1},a.props.showSpinner(),a.removeItem=a.removeItem.bind(a),a.importTemplate=a.importTemplate.bind(a),a.getSortOrder=a.getSortOrder.bind(a),a.confirmSave=a.confirmSave.bind(a),a.confirmTransition=a.confirmTransition.bind(a),a.newItemAdded=a.newItemAdded.bind(a),a.debouncedProductsFetch=(0,x.debounceProductsFetch)(a.props.debounceTime,a.props.minSearchLength,a.props.initialValues.origin.id),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),i(t,[{key:\"componentDidMount\",value:function(){this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchAllData(!1))}},{key:\"componentWillReceiveProps\",value:function(e){e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchAllData(!1))}},{key:\"getFields\",value:function(){return\"SUPPLIER\"===this.state.values.origin.type?T:r.default.get(this.state.values.stocklist,\"id\")?N:R}},{key:\"getLineItemsToBeSaved\",value:function(e){var t=this,a=r.default.filter(e,function(e){return!e.statusCode&&e.quantityRequested&&\"0\"!==e.quantityRequested&&e.product}),n=r.default.filter(e,function(e){return e.statusCode}),i=[];return r.default.forEach(n,function(e){var a=r.default.find(t.state.currentLineItems,function(t){return t.id===e.id}),n=parseInt(a.quantityRequested,10),s=parseInt(e.quantityRequested,10),o=a.recipient&&r.default.isObject(a.recipient)?a.recipient.id:a.recipient,l=e.recipient&&r.default.isObject(e.recipient)?e.recipient.id:e.recipient,u=r.default.remove(r.default.intersection(r.default.keys(a),r.default.keys(e)),function(e){return\"product\"!==e});(\"SUPPLIER\"!==t.state.values.origin.type||r.default.isEqual(r.default.pick(e,u),r.default.pick(a,u))&&e.product.id===a.product.id)&&s===n&&l===o||i.push(e)}),\"SUPPLIER\"===this.state.values.origin.type?[].concat(r.default.map(a,function(e){return{\"product.id\":e.product.id,quantityRequested:e.quantityRequested,palletName:e.palletName,boxName:e.boxName,lotNumber:e.lotNumber,expirationDate:e.expirationDate,\"recipient.id\":r.default.isObject(e.recipient)?e.recipient.id||\"\":e.recipient||\"\",sortOrder:e.sortOrder}}),r.default.map(i,function(e){return{id:e.id,\"product.id\":e.product.id,quantityRequested:e.quantityRequested,palletName:e.palletName,boxName:e.boxName,lotNumber:e.lotNumber,expirationDate:e.expirationDate,\"recipient.id\":r.default.isObject(e.recipient)?e.recipient.id||\"\":e.recipient||\"\",sortOrder:e.sortOrder}})):[].concat(r.default.map(a,function(e){return{\"product.id\":e.product.id,quantityRequested:e.quantityRequested,\"recipient.id\":r.default.isObject(e.recipient)?e.recipient.id||\"\":e.recipient||\"\",sortOrder:e.sortOrder}}),r.default.map(i,function(e){return{id:e.id,\"product.id\":e.product.id,quantityRequested:e.quantityRequested,\"recipient.id\":r.default.isObject(e.recipient)?e.recipient.id||\"\":e.recipient||\"\",sortOrder:e.sortOrder}}))}},{key:\"getSortOrder\",value:function(){return this.setState({sortOrder:this.state.sortOrder+100}),this.state.sortOrder}},{key:\"newItemAdded\",value:function(){this.setState({newItem:!0})}},{key:\"confirmSave\",value:function(e){(0,m.confirmAlert)({title:this.props.translate(\"react.stockMovement.message.confirmSave.label\",\"Confirm save\"),message:this.props.translate(\"react.stockMovement.confirmSave.message\",\"Are you sure you want to save? There are some lines with empty or zero quantity, those lines will be deleted.\"),buttons:[{label:this.props.translate(\"react.default.yes.label\",\"Yes\"),onClick:e},{label:this.props.translate(\"react.default.no.label\",\"No\")}]})}},{key:\"confirmTransition\",value:function(e,t){(0,m.confirmAlert)({title:this.props.translate(\"react.stockMovement.confirmTransition.label\",\"You have entered the same code twice. Do you want to continue?\"),message:r.default.map(t,function(e){return o.default.createElement(\"p\",{key:e.sortOrder},e.product.label,\" \",e.quantityRequested)}),buttons:[{label:this.props.translate(\"react.default.yes.label\",\"Yes\"),onClick:e},{label:this.props.translate(\"react.default.no.label\",\"No\")}]})}},{key:\"fetchAllData\",value:function(e){this.props.recipientsFetched&&!e||this.fetchData(this.props.fetchUsers),this.fetchAndSetLineItems()}},{key:\"fetchAndSetLineItems\",value:function(){var e=this;this.props.showSpinner(),this.fetchLineItems().then(function(t){var a=t.data.data.lineItems,i=void 0;i=a.length?r.default.map(a,function(e){return n({},e,{disabled:!0,product:n({},e.product,{label:e.productCode+\" \"+e.product.name})})}):new Array(1).fill({sortOrder:100});var s=r.default.toInteger(r.default.last(i).sortOrder)+100;e.setState({currentLineItems:a,values:n({},e.state.values,{lineItems:i}),sortOrder:s}),e.props.hideSpinner()}).catch(function(){return e.props.hideSpinner()})}},{key:\"fetchLineItems\",value:function(){var e=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"?stepNumber=2\";return E.default.get(e).then(function(e){return e}).catch(function(e){return e})}},{key:\"fetchData\",value:function(e){var t=this;this.props.showSpinner(),e().then(function(){return t.props.hideSpinner()}).catch(function(){return t.props.hideSpinner()})}},{key:\"nextPage\",value:function(e){var t=this,a=r.default.filter(e.lineItems,function(e){return!r.default.isEmpty(e)&&e.product});r.default.some(a,function(e){return!e.quantityRequested||\"0\"===e.quantityRequested})?this.confirmSave(function(){return t.checkDuplicatesSaveAndTransitionToNextStep(e,a)}):this.checkDuplicatesSaveAndTransitionToNextStep(e,a)}},{key:\"checkDuplicatesSaveAndTransitionToNextStep\",value:function(e,t){var a=this,n={};r.default.forEach(t,function(e){n[e.product.productCode]?n[e.product.productCode].push(e):n[e.product.productCode]=[e]});var i=r.default.filter(n,function(e){return e.length>1});r.default.some(n,function(e){return e.length>1})&&\"SUPPLIER\"!==this.state.values.origin.type?this.confirmTransition(function(){return a.saveAndTransitionToNextStep(e,t)},r.default.reduce(i,function(e,t){return e.concat(t)},[])):this.saveAndTransitionToNextStep(e,t)}},{key:\"saveAndTransitionToNextStep\",value:function(e,t){var a=this;this.props.showSpinner(),\"SUPPLIER\"===e.origin.type?this.saveRequisitionItems(t).then(function(t){var i=e;t&&(i=n({},e,{lineItems:t.data.data.lineItems})),a.transitionToNextStep(\"CHECKING\").then(function(){a.props.goToPage(6,i)}).catch(function(){return a.props.hideSpinner()})}).catch(function(){return a.props.hideSpinner()}):this.saveRequisitionItems(t).then(function(t){var i=e;t&&(i=n({},e,{lineItems:t.data.data.lineItems})),a.transitionToNextStep(\"VERIFYING\").then(function(){a.props.onSubmit(i)}).catch(function(){return a.props.hideSpinner()})}).catch(function(){return a.props.hideSpinner()})}},{key:\"saveRequisitionItems\",value:function(e){var t=this.getLineItemsToBeSaved(e),a=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/updateItems\",n={id:this.state.values.stockMovementId,lineItems:t};return n.lineItems.length?E.default.post(a,n).catch(function(){return Promise.reject(new Error(\"react.stockMovement.error.saveRequisitionItems.label\"))}):Promise.resolve()}},{key:\"saveRequisitionItemsInCurrentStep\",value:function(e){var t=this,a=this.getLineItemsToBeSaved(e),i=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/updateItems\",s={id:this.state.values.stockMovementId,lineItems:a};return s.lineItems.length?E.default.post(i,s).then(function(e){var a=e.data.data.lineItems,i=r.default.map(a,function(e){return n({},e,{product:n({},e.product,{label:e.productCode+\" \"+e.product.name})})});t.setState({values:n({},t.state.values,{lineItems:i})}),t.setState({currentLineItems:i})}).catch(function(){return Promise.reject(new Error(t.props.translate(\"react.stockMovement.error.saveRequisitionItems.label\",\"Could not save requisition items\")))}):Promise.resolve()}},{key:\"save\",value:function(e){var t=this,a=r.default.filter(e.lineItems,function(e){return!r.default.isEmpty(e)});r.default.some(a,function(e){return!e.quantityRequested||\"0\"===e.quantityRequested})?this.confirmSave(function(){return t.saveItems(a)}):this.saveItems(a)}},{key:\"saveAndExit\",value:function(e){O(e).lineItems.length?(0,m.confirmAlert)({title:this.props.translate(\"react.stockMovement.confirmExit.label\",\"Confirm save\"),message:this.props.translate(\"react.stockMovement.confirmExit.message\",\"Validation errors occurred. Are you sure you want to exit and lose unsaved data?\"),buttons:[{label:this.props.translate(\"react.default.yes.label\",\"Yes\"),onClick:function(){window.location=\"/openboxes/stockMovement/show/\"+e.stockMovementId}},{label:this.props.translate(\"react.default.no.label\",\"No\")}]}):this.saveRequisitionItemsInCurrentStep(e.lineItems).then(function(){window.location=\"/openboxes/stockMovement/show/\"+e.stockMovementId})}},{key:\"saveItems\",value:function(e){var t=this;this.props.showSpinner(),this.saveRequisitionItemsInCurrentStep(e).then(function(){t.props.hideSpinner(),p.default.success(t.props.translate(\"react.stockMovement.alert.saveSuccess.label\",\"Changes saved successfully\"),{timeout:3e3})}).catch(function(){return t.props.hideSpinner()})}},{key:\"refresh\",value:function(){var e=this;(0,m.confirmAlert)({title:this.props.translate(\"react.stockMovement.message.confirmRefresh.label\",\"Confirm refresh\"),message:this.props.translate(\"react.stockMovement.confirmRefresh.message\",\"Are you sure you want to refresh? Your progress since last save will be lost.\"),buttons:[{label:this.props.translate(\"react.default.yes.label\",\"Yes\"),onClick:function(){return e.fetchAllData(!0)}},{label:this.props.translate(\"react.default.no.label\",\"No\")}]})}},{key:\"removeItem\",value:function(e){var t=this,a=\"/openboxes/api/stockMovementItems/\"+e+\"/removeItem\";return E.default.delete(a).catch(function(){return t.props.hideSpinner(),Promise.reject(new Error(\"react.stockMovement.error.deleteRequisitionItem.label\"))})}},{key:\"removeAll\",value:function(){var e=this,t=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/removeAllItems\";return E.default.delete(t).catch(function(){return e.fetchAndSetLineItems(),e.props.hideSpinner(),Promise.reject(new Error(\"react.stockMovement.error.deleteRequisitionItem.label\"))})}},{key:\"transitionToNextStep\",value:function(e){var t=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/status\",a={status:e};return E.default.post(t,a)}},{key:\"exportTemplate\",value:function(e){var t=r.default.filter(e.lineItems,function(e){return!r.default.isEmpty(e)});this.saveItemsAndExportTemplate(e,t)}},{key:\"saveItemsAndExportTemplate\",value:function(e,t){var a=this;this.props.showSpinner();var n=e.movementNumber,i=\"/openboxes/stockMovement/exportCsv/\"+e.stockMovementId;this.saveRequisitionItemsInCurrentStep(t).then(function(){E.default.get(i,{responseType:\"blob\"}).then(function(e){(0,c.default)(e.data,\"ItemList\"+(n?\"-\"+n:\"\")+\".csv\",\"text/csv\"),a.props.hideSpinner()}).catch(function(){return a.props.hideSpinner()})})}},{key:\"importTemplate\",value:function(e){var t=this;this.props.showSpinner();var a=new FormData,n=e.target.files[0],i=this.state.values.stockMovementId;a.append(\"importFile\",n.slice(0,n.size,\"text/csv\"));var r=\"/openboxes/stockMovement/importCsv/\"+i;return E.default.post(r,a,{headers:{\"content-type\":\"multipart/form-data\"}}).then(function(){t.props.hideSpinner(),t.fetchAndSetLineItems()}).catch(function(){t.props.hideSpinner()})}},{key:\"previousPage\",value:function(e,t){var a=this;t?(0,m.confirmAlert)({title:this.props.translate(\"react.stockMovement.confirmPreviousPage.label\",\"Validation error\"),message:this.props.translate(\"react.stockMovement.confirmPreviousPage.message.label\",\"Cannot save due to validation error on page\"),buttons:[{label:this.props.translate(\"react.stockMovement.confirmPreviousPage.correctError.label\",\"Correct error\")},{label:this.props.translate(\"react.stockMovement.confirmPreviousPage.continue.label\",\"Continue (lose unsaved work)\"),onClick:function(){return a.props.previousPage(e)}}]}):this.saveRequisitionItemsInCurrentStep(e.lineItems).then(function(){return a.props.previousPage(e)})}},{key:\"render\",value:function(){var e=this;return o.default.createElement(d.Form,{onSubmit:function(){},validate:O,mutators:n({},f.default),initialValues:this.state.values,render:function(t){var a=t.handleSubmit,n=t.values,i=t.invalid;return o.default.createElement(\"div\",{className:\"d-flex flex-column\"},o.default.createElement(\"span\",null,o.default.createElement(\"label\",{htmlFor:\"csvInput\",className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-download pr-2\"}),o.default.createElement(P.default,{id:\"react.default.button.importTemplate.label\",defaultMessage:\"Import template\"})),o.default.createElement(\"input\",{id:\"csvInput\",type:\"file\",style:{display:\"none\"},onChange:e.importTemplate,onClick:function(e){e.target.value=null},accept:\".csv\"})),o.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.exportTemplate(n)},className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-upload pr-2\"}),o.default.createElement(P.default,{id:\"react.default.button.exportTemplate.label\",defaultMessage:\"Export template\"}))),o.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.refresh()},className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-refresh pr-2\"}),o.default.createElement(P.default,{id:\"react.default.button.refresh.label\",defaultMessage:\"Reload\"}))),o.default.createElement(\"button\",{type:\"button\",disabled:i,onClick:function(){return e.save(n)},className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-save pr-2\"}),o.default.createElement(P.default,{id:\"react.default.button.save.label\",defaultMessage:\"Save\"}))),o.default.createElement(\"button\",{type:\"button\",disabled:i,onClick:function(){return e.saveAndExit(n)},className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-sign-out pr-2\"}),o.default.createElement(P.default,{id:\"react.default.button.saveAndExit.label\",defaultMessage:\"Save and exit\"}))),o.default.createElement(\"button\",{type:\"button\",disabled:i,onClick:function(){return e.removeAll().then(function(){return e.fetchAndSetLineItems()})},className:\"float-right mb-1 btn btn-outline-danger align-self-end btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-remove pr-2\"}),o.default.createElement(P.default,{id:\"react.default.button.deleteAll.label\",defaultMessage:\"Delete all\"})))),o.default.createElement(\"form\",{onSubmit:a},r.default.map(e.getFields(),function(t,a){return(0,M.renderFormField)(t,a,{stocklist:n.stocklist,recipients:e.props.recipients,removeItem:e.removeItem,debouncedProductsFetch:e.debouncedProductsFetch,getSortOrder:e.getSortOrder,newItemAdded:e.newItemAdded,newItem:e.state.newItem})}),o.default.createElement(\"div\",null,o.default.createElement(\"button\",{type:\"submit\",onClick:function(){return e.previousPage(n,i)},className:\"btn btn-outline-primary btn-form btn-xs\"},o.default.createElement(P.default,{id:\"react.default.button.previous.label\",defaultMessage:\"Previous\"})),o.default.createElement(\"button\",{type:\"submit\",onClick:function(){i||e.nextPage(n)},className:\"btn btn-outline-primary btn-form float-right btn-xs\",disabled:!r.default.some(n.lineItems,function(e){return!r.default.isEmpty(e)})},o.default.createElement(P.default,{id:\"react.default.button.next.label\",defaultMessage:\"Next\"})))))}})}}]),t}();t.default=(0,l.connect)(function(e){return{recipients:e.users.data,recipientsFetched:e.users.fetched,translate:(0,q.translateWithDefaultMessage)((0,h.getTranslate)(e.localize)),stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement,debounceTime:e.session.searchConfig.debounceTime,minSearchLength:e.session.searchConfig.minSearchLength}},{showSpinner:I.showSpinner,hideSpinner:I.hideSpinner,fetchUsers:I.fetchUsers})(D),D.propTypes={initialValues:u.default.shape({origin:u.default.shape({id:u.default.string})}).isRequired,previousPage:u.default.func.isRequired,goToPage:u.default.func.isRequired,onSubmit:u.default.func.isRequired,showSpinner:u.default.func.isRequired,hideSpinner:u.default.func.isRequired,fetchUsers:u.default.func.isRequired,recipients:u.default.arrayOf(u.default.shape({})).isRequired,recipientsFetched:u.default.bool.isRequired,translate:u.default.func.isRequired,stockMovementTranslationsFetched:u.default.bool.isRequired,debounceTime:u.default.number.isRequired,minSearchLength:u.default.number.isRequired}},535:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=w(a(13)),s=a(1),o=w(s),l=a(25),u=a(253),c=w(a(264)),d=w(a(0)),f=w(a(53)),p=a(89),m=a(14),h=w(a(267));a(256);var b=w(a(257)),v=w(a(254)),y=a(250),g=w(a(261)),k=w(a(255)),S=w(a(536)),M=w(a(12)),I=w(a(289)),E=a(52),q=w(a(313)),P=a(88),x=w(P);function w(e){return e&&e.__esModule?e:{default:e}}var C={YES:\"btn btn-outline-success\",NO:\"disabled btn btn-outline-secondary\",EARLIER:\"btn btn-outline-warning\",HIDDEN:\"btn invisible\"},R={editPageItems:{type:b.default,virtualized:!0,rowComponent:I.default,getDynamicRowAttr:function(e){var t=e.rowValues,a=e.subfield,n=\"SUBSTITUTED\"===t.statusCode?\"crossed-out \":\"\";return a||(n+=\"font-weight-bold\"),{className:n}},subfieldKey:\"substitutionItems\",fields:{productCode:{type:g.default,flexWidth:\"0.6\",getDynamicAttr:function(e){return{className:e.subfield?\"text-center\":\"text-left ml-1\"}},label:\"react.stockMovement.code.label\",defaultMessage:\"Code\"},productName:{type:g.default,flexWidth:\"4.5\",label:\"react.stockMovement.productName.label\",getDynamicAttr:function(e){return{className:e.subfield?\"text-center\":\"text-left ml-1\"}}},quantityRequested:{type:g.default,label:\"react.stockMovement.quantityRequested.label\",defaultMessage:\"Qty requested\",flexWidth:\"1\",attributes:{formatValue:function(e){return e?e.toLocaleString(\"en-US\"):e}}},quantityAvailable:{type:g.default,label:\"react.stockMovement.quantityAvailable.label\",defaultMessage:\"Qty available\",flexWidth:\"1\",fieldKey:\"\",getDynamicAttr:function(e){var t=e.fieldValue,a=\"\";return(!t.quantityAvailable||t.quantityAvailable<t.quantityRequested)&&(a=\"text-danger\"),{className:a}},attributes:{formatValue:function(e){return e.quantityAvailable?e.quantityAvailable.toLocaleString(\"en-US\"):e.quantityAvailable}}},quantityConsumed:{type:g.default,label:\"react.stockMovement.monthlyQuantity.label\",defaultMessage:\"Monthly stocklist qty\",flexWidth:\"1.45\",getDynamicAttr:function(e){var t=e.hasStockList,a=e.translate;return{formatValue:function(e){return e&&\"0\"!==e?e.toLocaleString(\"en-US\"):t?a(\"react.stockMovement.replenishmentPeriodNotFound.label\",\"Replenishment period not found\"):\"0\"},showValueTooltip:!0}}},substituteButton:{label:\"react.stockMovement.substitution.label\",defaultMessage:\"Substitution\",type:S.default,fieldKey:\"\",flexWidth:\"1\",attributes:{title:\"react.stockMovement.substitutes.label\"},getDynamicAttr:function(e){var t=e.fieldValue,a=e.rowIndex,n=e.stockMovementId,i=e.onResponse,r=e.reviseRequisitionItems,s=e.values,o=e.reasonCodes;return{onOpen:function(){return r(s)},productCode:t.productCode,btnOpenText:\"react.stockMovement.\"+t.substitutionStatus+\".label\",btnOpenDefaultText:\"\"+t.substitutionStatus,btnOpenDisabled:\"NO\"===t.substitutionStatus||\"SUBSTITUTED\"===t.statusCode,btnOpenClassName:C[t.substitutionStatus||\"HIDDEN\"],rowIndex:a,lineItem:t,stockMovementId:n,onResponse:i,reasonCodes:o}}},quantityRevised:{label:\"react.stockMovement.quantityRevised.label\",defaultMessage:\"Qty revised\",type:v.default,fieldKey:\"statusCode\",flexWidth:\"1\",attributes:{type:\"number\"},getDynamicAttr:function(e){var t=e.fieldValue,a=e.subfield;return{disabled:\"SUBSTITUTED\"===t||a}}},reasonCode:{type:k.default,label:\"react.stockMovement.reasonCode.label\",defaultMessage:\"Reason code\",flexWidth:\"1.4\",fieldKey:\"quantityRevised\",getDynamicAttr:function(e){var t=e.fieldValue,a=e.subfield;return{disabled:!t||a,options:e.reasonCodes,showValueTooltip:!0}}},revert:{type:q.default,label:\"react.default.button.undo.label\",defaultMessage:\"Undo\",flexWidth:\"0.9\",fieldKey:\"\",buttonLabel:\"react.default.button.undo.label\",buttonDefaultMessage:\"Undo\",getDynamicAttr:function(e){var t=e.fieldValue,a=e.revertItem;return{onClick:t.requisitionItemId?function(){return a(t.requisitionItemId)}:function(){return null},hidden:!!t.statusCode&&!r.default.includes([\"CHANGED\",\"CANCELED\"],t.statusCode)}},attributes:{className:\"btn btn-outline-danger\"}}}}};function N(e){var t={editPageItems:[]};return r.default.forEach(e.editPageItems,function(e,a){!r.default.isEmpty(e.quantityRevised)&&r.default.isEmpty(e.reasonCode)?t.editPageItems[a]={reasonCode:\"react.stockMovement.errors.reasonCodeRequired.label\"}:r.default.isNil(e.quantityRevised)&&!r.default.isEmpty(e.reasonCode)&&\"SUBSTITUTED\"!==e.statusCode&&(t.editPageItems[a]={quantityRevised:\"react.stockMovement.errors.revisedQuantityRequired.label\"}),parseInt(e.quantityRevised,10)===e.quantityRequested&&(t.editPageItems[a]={quantityRevised:\"react.stockMovement.errors.sameRevisedQty.label\"}),!r.default.isEmpty(e.quantityRevised)&&e.quantityRevised>e.quantityAvailable&&(t.editPageItems[a]={quantityRevised:\"react.stockMovement.errors.higherQty.label\"}),!r.default.isEmpty(e.quantityRevised)&&e.quantityRevised<0&&(t.editPageItems[a]={quantityRevised:\"react.stockMovement.errors.negativeQty.label\"})}),t}function T(e){var t=N(e);return r.default.forEach(e.editPageItems,function(e,a){r.default.isNil(e.quantityRevised)&&e.quantityRequested>e.quantityAvailable&&\"SUBSTITUTED\"!==e.statusCode&&(t.editPageItems[a]={quantityRevised:\"react.stockMovement.errors.lowerQty.label\"})}),t}var O=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.dataFetched=!1,a.state={statusCode:\"\",revisedItems:[],values:n({},a.props.initialValues,{editPageItems:[]})},a.revertItem=a.revertItem.bind(a),a.fetchEditPageItems=a.fetchEditPageItems.bind(a),a.reviseRequisitionItems=a.reviseRequisitionItems.bind(a),a.props.showSpinner(),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),i(t,[{key:\"componentDidMount\",value:function(){this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchAllData(!1))}},{key:\"componentWillReceiveProps\",value:function(e){e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchAllData(!1))}},{key:\"fetchAllData\",value:function(e){var t=this;this.props.reasonCodesFetched&&!e||this.fetchData(this.props.fetchReasonCodes),this.props.showSpinner(),this.fetchLineItems().then(function(e){var a=e.data.data,i=a.statusCode,s=a.editPage,o=r.default.map(s.editPageItems,function(e){return n({},e,{disabled:!0,quantityAvailable:e.quantityAvailable>0?e.quantityAvailable:0,product:n({},e.product,{label:e.productCode+\" \"+e.productName}),substitutionItems:r.default.map(e.substitutionItems,function(t){return n({},t,{requisitionItemId:e.requisitionItemId})})})});t.setState({statusCode:i,revisedItems:r.default.filter(o,function(e){return\"CHANGED\"===e.statusCode}),values:n({},t.state.values,{editPageItems:o})}),t.props.hideSpinner()}).catch(function(){t.props.hideSpinner()})}},{key:\"fetchData\",value:function(e){var t=this;this.props.showSpinner(),e().then(function(){return t.props.hideSpinner()}).catch(function(){return t.props.hideSpinner()})}},{key:\"reviseRequisitionItems\",value:function(e){var t=this,a=r.default.filter(e.editPageItems,function(e){if(e.quantityRevised&&e.reasonCode){var a=r.default.find(t.state.revisedItems,function(t){return t.requisitionItemId===e.requisitionItemId});return!!r.default.isEmpty(a)||(r.default.toInteger(a.quantityRevised)!==r.default.toInteger(e.quantityRevised)||a.reasonCode!==e.reasonCode)}return!1}),n=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/reviseItems\",i={lineItems:r.default.map(a,function(e){return{id:e.requisitionItemId,quantityRevised:e.quantityRevised,reasonCode:e.reasonCode}})};return i.lineItems.length?M.default.post(n,i):Promise.resolve()}},{key:\"save\",value:function(e){var t=this;this.props.showSpinner();var a=N(e).editPageItems;if(a.length){var n=this.props.translate(\"react.stockMovement.errors.errorInLine.label\",\"Error occurred in line\")+\":</br>\";return n+=r.default.reduce(a,function(e,a,n){return e+(a?n+1+\" - \"+r.default.map(a,function(e){return t.props.translate(\"\"+e)})+\"</br>\":\"\")},\"\"),f.default.error(n),this.props.hideSpinner(),null}return this.reviseRequisitionItems(e).then(function(e){var a=r.default.get(e,\"data.data.editPage.editPageItems\");a&&a.length&&t.setState({revisedItems:r.default.filter(a,function(e){return\"CHANGED\"===e.statusCode})}),t.props.hideSpinner(),f.default.success(t.props.translate(\"react.stockMovement.alert.saveSuccess.label\",\"Changes saved successfully\"),{timeout:3e3})}).catch(function(){return t.props.hideSpinner()})}},{key:\"refresh\",value:function(){var e=this;(0,p.confirmAlert)({title:this.props.translate(\"react.stockMovement.message.confirmRefresh.label\",\"Confirm refresh\"),message:this.props.translate(\"react.stockMovement.confirmRefresh.message\",\"Are you sure you want to refresh? Your progress since last save will be lost.\"),buttons:[{label:this.props.translate(\"react.default.yes.label\",\"Yes\"),onClick:function(){e.setState({revisedItems:[]}),e.fetchAllData(!0)}},{label:this.props.translate(\"react.default.no.label\",\"No\")}]})}},{key:\"transitionToNextStep\",value:function(){var e=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/status\",t={status:\"PICKING\",createPicklist:\"VERIFYING\"===this.state.statusCode?\"true\":\"false\"};return M.default.post(e,t)}},{key:\"fetchLineItems\",value:function(){var e=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"?stepNumber=3\";return M.default.get(e).then(function(e){return e}).catch(function(e){return e})}},{key:\"nextPage\",value:function(e){var t=this;this.props.showSpinner(),this.reviseRequisitionItems(e).then(function(){t.transitionToNextStep().then(function(){return t.props.onSubmit(e)}).catch(function(){return t.props.hideSpinner()})}).catch(function(){return t.props.hideSpinner()})}},{key:\"updateEditPageItem\",value:function(e){var t=r.default.findIndex(this.state.values.editPageItems,function(t){return t.requisitionItemId===e.requisitionItemId});this.setState({values:n({},this.state.values,{editPageItems:(0,h.default)(this.state.values.editPageItems,function(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}({},t,{$set:n({},e,{quantityAvailable:e.quantityAvailable||0,substitutionItems:r.default.map(e.substitutionItems,function(t){return n({},t,{requisitionItemId:e.requisitionItemId})})})}))})})}},{key:\"fetchEditPageItems\",value:function(){var e=this;this.fetchLineItems().then(function(t){var a=t.data.data.editPage;e.setState({values:n({},e.state.values,{editPageItems:r.default.map(a.editPageItems,function(e){return n({},e,{quantityAvailable:e.quantityAvailable||0,substitutionItems:r.default.map(e.substitutionItems,function(t){return n({},t,{requisitionItemId:e.requisitionItemId})})})})})}),e.props.hideSpinner()}).catch(function(){e.props.hideSpinner()})}},{key:\"saveAndExit\",value:function(e){N(e).editPageItems.length?((0,p.confirmAlert)({title:this.props.translate(\"react.stockMovement.confirmExit.label\",\"Confirm save\"),message:this.props.translate(\"react.stockMovement.confirmExit.message\",\"Validation errors occurred. Are you sure you want to exit and lose unsaved data?\"),buttons:[{label:this.props.translate(\"react.default.yes.label\",\"Yes\"),onClick:function(){window.location=\"/openboxes/stockMovement/show/\"+e.stockMovementId}},{label:this.props.translate(\"react.default.no.label\",\"No\")}]}),this.props.hideSpinner()):this.reviseRequisitionItems(e).then(function(){window.location=\"/openboxes/stockMovement/show/\"+e.stockMovementId})}},{key:\"revertItem\",value:function(e){var t=this;this.props.showSpinner();var a=\"/openboxes/api/stockMovementItems/\"+e+\"/revertItem\";return M.default.post(a).then(function(e){var a=e.data.data;t.updateEditPageItem(a),t.props.hideSpinner()}).catch(function(){return t.props.hideSpinner(),Promise.reject(new Error(t.props.translate(\"react.stockMovement.error.revertRequisitionItem.label\",\"Could not revert requisition items\")))})}},{key:\"previousPage\",value:function(e,t){var a=this;t?(0,p.confirmAlert)({title:this.props.translate(\"react.stockMovement.confirmPreviousPage.label\",\"Validation error\"),message:this.props.translate(\"react.stockMovement.confirmPreviousPage.message.label\",\"Cannot save due to validation error on page\"),buttons:[{label:this.props.translate(\"react.stockMovement.confirmPreviousPage.correctError.label\",\"Correct error\")},{label:this.props.translate(\"react.stockMovement.confirmPreviousPage.continue.label\",\"Continue (lose unsaved work)\"),onClick:function(){return a.props.previousPage(e)}}]}):this.reviseRequisitionItems(e).then(function(){return a.props.previousPage(e)})}},{key:\"render\",value:function(){var e=this;return o.default.createElement(u.Form,{onSubmit:function(){},validate:T,mutators:n({},c.default),initialValues:this.state.values,render:function(t){var a=t.handleSubmit,n=t.values,i=t.invalid;return o.default.createElement(\"div\",{className:\"d-flex flex-column\"},o.default.createElement(\"span\",null,o.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.refresh()},className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-refresh pr-2\"}),o.default.createElement(x.default,{id:\"react.default.button.refresh.label\",defaultMessage:\"Reload\"}))),o.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.save(n)},className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-save pr-2\"}),o.default.createElement(x.default,{id:\"react.default.button.save.label\",defaultMessage:\"Save\"}))),o.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.saveAndExit(n)},className:\"float-right mb-1 btn btn-outline-secondary align-self-end btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-sign-out pr-2\"}),o.default.createElement(x.default,{id:\"react.default.button.saveAndExit.label\",defaultMessage:\"Save and exit\"})))),o.default.createElement(\"form\",{onSubmit:a},r.default.map(R,function(t,a){return(0,y.renderFormField)(t,a,{stockMovementId:n.stockMovementId,hasStockList:!!r.default.get(n.stocklist,\"id\"),translate:e.props.translate,reasonCodes:e.props.reasonCodes,onResponse:e.fetchEditPageItems,revertItem:e.revertItem,reviseRequisitionItems:e.reviseRequisitionItems,values:n})}),o.default.createElement(\"div\",null,o.default.createElement(\"button\",{type:\"submit\",onClick:function(){return e.previousPage(n,i)},className:\"btn btn-outline-primary btn-form btn-xs\"},o.default.createElement(x.default,{id:\"react.default.button.previous.label\",defaultMessage:\"Previous\"})),o.default.createElement(\"button\",{type:\"submit\",onClick:function(){i||e.nextPage(n)},className:\"btn btn-outline-primary btn-form float-right btn-xs\"},o.default.createElement(x.default,{id:\"react.default.button.next.label\",defaultMessage:\"Next\"})))))}})}}]),t}();t.default=(0,l.connect)(function(e){return{reasonCodesFetched:e.reasonCodes.fetched,reasonCodes:e.reasonCodes.data,translate:(0,P.translateWithDefaultMessage)((0,m.getTranslate)(e.localize)),stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement}},{fetchReasonCodes:E.fetchReasonCodes,showSpinner:E.showSpinner,hideSpinner:E.hideSpinner})(O),O.propTypes={initialValues:d.default.shape({}).isRequired,previousPage:d.default.func.isRequired,onSubmit:d.default.func.isRequired,showSpinner:d.default.func.isRequired,hideSpinner:d.default.func.isRequired,fetchReasonCodes:d.default.func.isRequired,reasonCodesFetched:d.default.bool.isRequired,reasonCodes:d.default.arrayOf(d.default.shape({})).isRequired,translate:d.default.func.isRequired,stockMovementTranslationsFetched:d.default.bool.isRequired}},536:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=a(1),s=y(r),o=y(a(0)),l=y(a(13)),u=a(25),c=y(a(274)),d=y(a(261)),f=y(a(257)),p=y(a(254)),m=y(a(255)),h=y(a(12)),b=a(52),v=y(a(88));function y(e){return e&&e.__esModule?e:{default:e}}var g={reasonCode:{type:m.default,label:\"react.stockMovement.reasonFor.label\",defaultMessage:\"Reason for not fulfilling full qty\",attributes:{required:!0},getDynamicAttr:function(e){return{options:e.reasonCodes,hidden:!e.originalItem}}},substitutions:{type:f.default,getDynamicRowAttr:function(e){var t=e.rowValues,a=e.originalItem,n=new Date(t.minExpirationDate),i=a&&a.minExpirationDate?new Date(a.minExpirationDate):null;return{className:t.originalItem?\"font-weight-bold\":i&&n&&n<i||!i&&n?\"text-danger\":\"\"}},fields:{productCode:{type:d.default,label:\"react.stockMovement.code.label\",defaultMessage:\"Code\"},productName:{type:d.default,label:\"react.stockMovement.productName.label\",defaultMessage:\"Product name\"},minExpirationDate:{type:d.default,label:\"react.stockMovement.expiry.label\",defaultMessage:\"Expiry\"},quantityAvailable:{type:d.default,label:\"react.stockMovement.quantityAvailable.label\",defaultMessage:\"Qty Available\",fixedWidth:\"150px\",fieldKey:\"\",attributes:{formatValue:function(e){return l.default.get(e,\"quantityAvailable\")?l.default.get(e,\"quantityAvailable\").toLocaleString(\"en-US\"):null},showValueTooltip:!0},getDynamicAttr:function(e){var t=e.fieldValue;return{tooltipValue:l.default.map(t.availableItems,function(e){return s.default.createElement(\"p\",null,t.productCode,\" \",t.productName,\", \",e.expirationDate?e.expirationDate:\"---\",\", Qty \",e.quantityAvailable)})}}},quantitySelected:{type:p.default,label:\"react.stockMovement.quantitySelected.label\",defaultMessage:\"Quantity selected\",fixedWidth:\"140px\",attributes:{type:\"number\"}}}}};function k(e){var t={substitutions:[]},a=null,n=0;return l.default.forEach(e.substitutions,function(e,i){e.originalItem&&(a=e),e.quantitySelected&&(n+=l.default.toInteger(e.quantitySelected)),e.quantitySelected>e.quantityAvailable&&(t.substitutions[i]={quantitySelected:\"react.stockMovement.errors.higherQtySelected.label\"}),e.quantitySelected<0&&(t.substitutions[i]={quantitySelected:\"react.stockMovement.errors.negativeQtySelected.label\"})}),a&&a.quantitySelected&&n<a.quantityRequested&&!e.reasonCode&&(t.reasonCode=\"react.default.error.requiredField.label\"),t}var S=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=e.fieldConfig,r=i.attributes,s=i.getDynamicAttr,o=s?s(e):{},l=n({},r,o);return a.state={attr:l,formValues:{},originalItem:null},a.onOpen=a.onOpen.bind(a),a.onSave=a.onSave.bind(a),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.Component),i(t,[{key:\"componentWillReceiveProps\",value:function(e){var t=e.fieldConfig,a=t.attributes,i=t.getDynamicAttr,r=i?i(e):{},s=n({},a,r);this.setState({attr:s})}},{key:\"onOpen\",value:function(){this.state.attr.onOpen();var e=this.state.attr.lineItem.availableSubstitutions,t=null;l.default.toInteger(this.state.attr.lineItem.quantityAvailable)>0&&(e=[t=n({},this.state.attr.lineItem,{originalItem:!0})].concat(function(e){if(Array.isArray(e)){for(var t=0,a=Array(e.length);t<e.length;t++)a[t]=e[t];return a}return Array.from(e)}(this.state.attr.lineItem.availableSubstitutions))),this.setState({formValues:{substitutions:e,reasonCode:t?\"\":\"SUBSTITUTION\"},originalItem:t})}},{key:\"onSave\",value:function(e){var t=this;this.props.showSpinner();var a=l.default.filter(e.substitutions,function(e){return e.quantitySelected>0&&!e.originalItem}),n=l.default.reduce(e.substitutions,function(e,t){return e+(t.originalItem?0:l.default.toInteger(t.quantitySelected))},0),i=l.default.find(e.substitutions,function(e){return e.originalItem})||this.state.attr.lineItem,r=\"/openboxes/api/stockMovementItems/\"+i.requisitionItemId+\"/substituteItem\",s={newQuantity:i.quantitySelected&&\"0\"!==i.quantitySelected?i.quantityRequested-n:\"\",quantityRevised:i.quantitySelected,reasonCode:e.reasonCode,sortOrder:i.sortOrder,substitutionItems:l.default.map(a,function(e){return{\"newProduct.id\":e.productId,newQuantity:e.quantitySelected,reasonCode:\"SUBSTITUTION\",sortOrder:i.sortOrder}})};h.default.post(r,s).then(function(){t.props.onResponse()}).catch(function(){t.props.hideSpinner()})}},{key:\"calculateSelected\",value:function(e){return s.default.createElement(\"div\",null,s.default.createElement(\"div\",{className:\"form-group pb-2\"},s.default.createElement(\"label\",{htmlFor:\"quantity-selected\",className:\"col-sm-2 col-form-label font-weight-bold\"},s.default.createElement(v.default,{id:\"react.stockMovement.quantitySelected.label\",defaultMessage:\"Quantity selected\"})),s.default.createElement(\"div\",{id:\"quantity-selected\"},l.default.reduce(e.substitutions,function(e,t){return e+(t.quantitySelected?l.default.toInteger(t.quantitySelected):0)},0))))}},{key:\"render\",value:function(){return s.default.createElement(c.default,n({},this.state.attr,{onOpen:this.onOpen,onSave:this.onSave,fields:g,validate:k,initialValues:this.state.formValues,formProps:{reasonCodes:this.state.attr.reasonCodes,originalItem:this.state.originalItem},renderBodyWithValues:this.calculateSelected}),s.default.createElement(\"div\",null,s.default.createElement(\"div\",{className:\"form-group\"},s.default.createElement(\"label\",{htmlFor:\"product\",className:\"col-sm-2 col-form-label font-weight-bold\"},s.default.createElement(v.default,{id:\"react.stockMovement.product.label\",defaultMessage:\"Product\"})),s.default.createElement(\"div\",{id:\"product\",className:\"col-sm-10\"},this.state.attr.lineItem.productCode,\" \",this.state.attr.lineItem.productName)),s.default.createElement(\"div\",{className:\"form-group\"},s.default.createElement(\"label\",{htmlFor:\"quantity-requested\",className:\"col-sm-2 col-form-label font-weight-bold\"},s.default.createElement(v.default,{id:\"react.stockMovement.quantityRequested.label\",defaultMessage:\"Quantity requested\"})),s.default.createElement(\"div\",{id:\"quantity-requested\",className:\"col-sm-10\"},this.state.attr.lineItem.quantityRequested))))}}]),t}();t.default=(0,u.connect)(null,{showSpinner:b.showSpinner,hideSpinner:b.hideSpinner})(S),S.propTypes={fieldName:o.default.string.isRequired,fieldConfig:o.default.shape({getDynamicAttr:o.default.func}).isRequired,stockMovementId:o.default.string.isRequired,showSpinner:o.default.func.isRequired,hideSpinner:o.default.func.isRequired,onResponse:o.default.func.isRequired}},537:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=x(a(13)),s=a(1),o=x(s),l=a(25),u=a(253),c=x(a(264)),d=x(a(0)),f=a(14),p=x(a(276)),m=x(a(267)),h=x(a(53));a(256);var b=x(a(257)),v=x(a(261)),y=a(250),g=x(a(538)),k=a(52),S=x(a(289)),M=a(12),I=x(M),E=x(a(313)),q=a(88),P=x(q);function x(e){return e&&e.__esModule?e:{default:e}}var w={pickPageItems:{type:b.default,virtualized:!0,rowComponent:S.default,subfieldKey:\"picklistItems\",getDynamicRowAttr:function(e){var t=e.rowValues,a=e.subfield,n=t.initial?\"crossed-out \":\"\";return a||(n+=\"font-weight-bold\"),{className:n}},fields:{productCode:{type:v.default,label:\"react.stockMovement.code.label\",defaultMessage:\"Code\",flexWidth:\"0.9\",getDynamicAttr:function(e){return{className:e.subfield?\"text-center\":\"text-left ml-1\"}}},\"product.name\":{type:v.default,label:\"react.stockMovement.productName.label\",defaultMessage:\"Product name\",flexWidth:\"4.7\",attributes:{className:\"text-left ml-1\"}},lotNumber:{type:v.default,flexWidth:\"1.3\",label:\"react.stockMovement.lot.label\",defaultMessage:\"Lot\"},expirationDate:{type:v.default,flexWidth:\"0.9\",label:\"react.stockMovement.expiry.label\",defaultMessage:\"Expiry\"},\"binLocation.name\":{type:v.default,flexWidth:\"1.2\",label:\"react.stockMovement.binLocation.label\",defaultMessage:\"Bin location\"},quantityRequired:{type:v.default,label:\"react.stockMovement.quantityRequired.label\",defaultMessage:\"Qty required\",flexWidth:\"0.8\",attributes:{formatValue:function(e){return e?e.toLocaleString(\"en-US\"):e}}},quantityPicked:{type:v.default,label:\"react.stockMovement.quantityPicked.label\",defaultMessage:\"Qty picked\",flexWidth:\"0.7\",attributes:{formatValue:function(e){return e?e.toLocaleString(\"en-US\"):e}}},buttonEditPick:{label:\"react.stockMovement.editPick.label\",defaultMessage:\"Edit pick\",type:g.default,fieldKey:\"\",flexWidth:\"0.6\",attributes:{title:\"react.stockMovement.editPick.label\"},getDynamicAttr:function(e){var t=e.fieldValue,a=e.subfield,n=e.stockMovementId,i=e.updatePickPageItem,r=e.reasonCodes;return{fieldValue:(0,M.flattenRequest)(t),subfield:a,stockMovementId:n,btnOpenText:t.hasChangedPick?\"\":\"react.default.button.edit.label\",btnOpenDefaultText:t.hasChangedPick?\"\":\"Edit\",btnOpenClassName:t.hasChangedPick?\" btn fa fa-check btn-outline-success\":\"btn btn-outline-primary\",onResponse:i,reasonCodes:r}}},buttonAdjustInventory:{label:\"react.stockMovement.adjustStock.label\",defaultMessage:\"Adjust stock\",buttonLabel:\"react.stockMovement.adjustStock.label\",buttonDefaultMessage:\"Adjust stock\",type:E.default,fieldKey:\"\",flexWidth:\"1.3\",attributes:{className:\"btn btn-outline-primary\"},getDynamicAttr:function(e){var t=e.subfield,a=e.translate;return{hidden:t,onClick:function(){return h.default.error(a(\"react.stockMovement.alert.disabledAdjustment.label\",\"This feature is not available yet. Please adjust stock on the electronic stock card page.\"))}}}},revert:{type:E.default,label:\"react.default.button.undoEdit.label\",defaultMessage:\"Undo edit\",flexWidth:\"0.7\",fieldKey:\"\",buttonLabel:\"react.default.button.undoEdit.label\",buttonDefaultMessage:\"Undo edit\",getDynamicAttr:function(e){var t=e.fieldValue,a=e.revertUserPick,n=e.subfield;return{onClick:(0,M.flattenRequest)(t)[\"requisitionItem.id\"]?function(){return a((0,M.flattenRequest)(t)[\"requisitionItem.id\"])}:function(){return null},hidden:n}},attributes:{className:\"btn btn-outline-danger\"}}}}},C=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.dataFetched=!1,a.state={bins:[],sorted:!1,printPicksUrl:\"\",values:a.props.initialValues},a.revertUserPick=a.revertUserPick.bind(a),a.updatePickPageItem=a.updatePickPageItem.bind(a),a.fetchAdjustedItems=a.fetchAdjustedItems.bind(a),a.sortByBins=a.sortByBins.bind(a),a.importTemplate=a.importTemplate.bind(a),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),i(t,[{key:\"componentDidMount\",value:function(){this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchAllData(!1))}},{key:\"componentWillReceiveProps\",value:function(e){e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchAllData(!1))}},{key:\"fetchAllData\",value:function(e){this.props.showSpinner(),this.props.reasonCodesFetched&&!e||this.props.fetchReasonCodes(),this.fetchPickPageData()}},{key:\"checkForInitialPicksChanges\",value:function(e){if(e.picklistItems.length){var t=[];return r.default.forEach(e.suggestedItems,function(a){var i=r.default.find(e.picklistItems,function(e){return r.default.get(a,\"inventoryItem.id\")===r.default.get(e,\"inventoryItem.id\")&&r.default.get(e,\"binLocation.id\")===r.default.get(a,\"binLocation.id\")});(r.default.isEmpty(i)||i.quantityPicked!==a.quantityPicked)&&t.push(n({},a,{initial:!0}))}),n({},e,{picklistItems:r.default.sortBy(r.default.concat(e.picklistItems,t),[\"binLocation.name\",\"initial\"])})}return e}},{key:\"fetchPickPageData\",value:function(){var e=this,t=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"?stepNumber=4\";return I.default.get(t).then(function(t){var a=t.data.data.associations,i=t.data.data.pickPage.pickPageItems,s=r.default.find(a.documents,function(e){return\"PICKLIST\"===e.documentType&&e.uri.includes(\"print\")});e.setState({printPicksUrl:s?s.uri:\"/\",values:n({},e.state.values,{pickPageItems:r.default.map((0,M.parseResponse)(i),function(t){return e.checkForInitialPicksChanges(t)})}),sorted:!1},function(){return e.fetchBins()})}).catch(function(){return e.props.hideSpinner()})}},{key:\"fetchAdjustedItems\",value:function(e){var t=this;I.default.post(\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/updateAdjustedItems?adjustedProduct=\"+e).then(function(e){var a=e.data.data.pickPage.pickPageItems;t.setState({values:n({},t.state.values,{pickPageItems:r.default.map((0,M.parseResponse)(a),function(e){return t.checkForInitialPicksChanges(e)})}),sorted:!1}),t.props.hideSpinner()}).catch(function(){t.props.hideSpinner()})}},{key:\"fetchBins\",value:function(){var e=this,t=\"/openboxes/api/internalLocations?location.id=\"+this.state.values.origin.id;return I.default.get(t).then(function(t){var a=r.default.map(t.data.data,function(e){return{value:e.id,label:e.name,name:e.name}});e.setState({bins:a},function(){return e.props.hideSpinner()})}).catch(function(){return e.props.hideSpinner()})}},{key:\"transitionToNextStep\",value:function(){var e=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/status\";return I.default.post(e,{status:\"PICKED\"})}},{key:\"nextPage\",value:function(e){var t=this;this.props.showSpinner(),this.transitionToNextStep().then(function(){return t.props.onSubmit(e)}).catch(function(){return t.props.hideSpinner()})}},{key:\"updatePickPageItem\",value:function(e){var t=r.default.findIndex(this.state.values.pickPageItems,function(t){return r.default.get(t,\"requisitionItem.id\")===r.default.get(e,\"requisitionItem.id\")});this.setState({values:n({},this.state.values,{pickPageItems:(0,m.default)(this.state.values.pickPageItems,function(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}({},t,{$set:this.checkForInitialPicksChanges((0,M.parseResponse)(e))}))})})}},{key:\"revertUserPick\",value:function(e){var t=this;this.props.showSpinner();var a=\"/openboxes/api/stockMovementItems/\"+e+\"/createPicklist\";I.default.post(a).then(function(e){var a=e.data.data;t.updatePickPageItem(a),t.props.hideSpinner()}).catch(function(){t.props.hideSpinner()})}},{key:\"sortByBins\",value:function(){var e=this,t=this.state.sorted,a=void 0;a=t?r.default.orderBy(this.state.values.pickPageItems,[\"sortOrder\"],[\"asc\"]):r.default.orderBy(this.state.values.pickPageItems,[\"picklistItems[0].binLocation.name\"],[\"asc\"]),this.setState({values:n({},this.state.values,{pickPageItems:[]})},function(){return e.setState({values:n({},e.state.values,{pickPageItems:a}),sorted:!e.state.sorted})})}},{key:\"exportTemplate\",value:function(e){var t=this;this.props.showSpinner();var a=e.movementNumber,n=\"/openboxes/api/stockMovements/exportPickListItems/\"+e.stockMovementId;I.default.get(n,{responseType:\"blob\"}).then(function(e){(0,p.default)(e.data,\"PickListItems\"+(a?\"-\"+a:\"\")+\".csv\",\"text/csv\"),t.props.hideSpinner()}).catch(function(){return t.props.hideSpinner()})}},{key:\"importTemplate\",value:function(e){var t=this;this.props.showSpinner();var a=new FormData,n=e.target.files[0],i=this.state.values.stockMovementId;a.append(\"importFile\",n.slice(0,n.size,\"text/csv\"));var r=\"/openboxes/api/stockMovements/importPickListItems/\"+i;return I.default.post(r,a,{headers:{\"content-type\":\"multipart/form-data\"}}).then(function(){t.props.hideSpinner(),t.fetchAllData(!1)}).catch(function(){t.props.hideSpinner()})}},{key:\"render\",value:function(){var e=this;return o.default.createElement(u.Form,{onSubmit:function(t){return e.nextPage(t)},mutators:n({},c.default),initialValues:this.state.values,render:function(t){var a=t.handleSubmit,n=t.values;return o.default.createElement(\"div\",{className:\"d-flex flex-column\"},o.default.createElement(\"span\",null,o.default.createElement(\"label\",{htmlFor:\"csvInput\",className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-download pr-2\"}),o.default.createElement(P.default,{id:\"react.default.button.importTemplate.label\",defaultMessage:\"Import template\"})),o.default.createElement(\"input\",{id:\"csvInput\",type:\"file\",style:{display:\"none\"},onChange:e.importTemplate,onClick:function(e){e.target.value=null},accept:\".csv\"})),o.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.exportTemplate(n)},className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-upload pr-2\"}),o.default.createElement(P.default,{id:\"react.default.button.exportTemplate.label\",defaultMessage:\"Export template\"}))),o.default.createElement(\"a\",{href:e.state.printPicksUrl+(e.state.sorted?\"?sorted=true\":\"\"),className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\",target:\"_blank\",rel:\"noopener noreferrer\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-print pr-2\"}),o.default.createElement(P.default,{id:\"react.stockMovement.printPicklist.label\",defaultMessage:\"Print picklist\"}))),o.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.fetchAllData(!0)},className:\"float-right mb-1 btn btn-outline-secondary align-self-end btn-xs ml-1\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-refresh pr-2\"}),o.default.createElement(P.default,{id:\"react.default.button.refresh.label\",defaultMessage:\"Reload\"}))),o.default.createElement(\"button\",{type:\"button\",onClick:function(){window.location=\"/openboxes/stockMovement/show/\"+n.stockMovementId},className:\"float-right mb-1 btn btn-outline-secondary align-self-end btn-xs ml-1\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-sign-out pr-2\"}),o.default.createElement(P.default,{id:\"react.default.button.saveAndExit.label\",defaultMessage:\"Save and exit\"}))),o.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.sortByBins()},className:\"float-right mb-1 btn btn-outline-secondary align-self-end btn-xs\"},e.state.sorted&&o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-sort pr-2\"}),o.default.createElement(P.default,{id:\"react.stockMovement.originalOrder.label\",defaultMessage:\"Original order\"})),!e.state.sorted&&o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-sort pr-2\"}),o.default.createElement(P.default,{id:\"react.stockMovement.sortByBins.label\",defaultMessage:\"Sort by bins\"})))),o.default.createElement(\"form\",{onSubmit:a,className:\"print-mt\"},r.default.map(w,function(t,a){return(0,y.renderFormField)(t,a,{stockMovementId:n.stockMovementId,updatePickPageItem:e.updatePickPageItem,fetchAdjustedItems:e.fetchAdjustedItems,revertUserPick:e.revertUserPick,bins:e.state.bins,locationId:e.state.values.origin.id,reasonCodes:e.props.reasonCodes,translate:e.props.translate})}),o.default.createElement(\"div\",{className:\"d-print-none\"},o.default.createElement(\"button\",{type:\"button\",className:\"btn btn-outline-primary btn-form btn-xs\",onClick:function(){return e.props.previousPage(n)}},o.default.createElement(P.default,{id:\"react.default.button.previous.label\",defaultMessage:\"Previous\"})),o.default.createElement(\"button\",{type:\"submit\",className:\"btn btn-outline-primary btn-form float-right btn-xs\"},o.default.createElement(P.default,{id:\"react.default.button.next.label\",defaultMessage:\"Next\"})))))}})}}]),t}();t.default=(0,l.connect)(function(e){return{translate:(0,q.translateWithDefaultMessage)((0,f.getTranslate)(e.localize)),reasonCodesFetched:e.reasonCodes.fetched,reasonCodes:e.reasonCodes.data,stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement}},{showSpinner:k.showSpinner,hideSpinner:k.hideSpinner,fetchReasonCodes:k.fetchReasonCodes})(C),C.propTypes={initialValues:d.default.shape({}).isRequired,onSubmit:d.default.func.isRequired,previousPage:d.default.func.isRequired,showSpinner:d.default.func.isRequired,hideSpinner:d.default.func.isRequired,fetchReasonCodes:d.default.func.isRequired,reasonCodesFetched:d.default.bool.isRequired,reasonCodes:d.default.arrayOf(d.default.shape({})).isRequired,stockMovementTranslationsFetched:d.default.bool.isRequired,translate:d.default.func.isRequired}},538:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=a(1),s=y(r),o=y(a(13)),l=y(a(0)),u=a(25),c=y(a(274)),d=y(a(261)),f=y(a(254)),p=y(a(257)),m=y(a(255)),h=y(a(12)),b=a(52),v=y(a(88));function y(e){return e&&e.__esModule?e:{default:e}}var g={reasonCode:{type:m.default,label:\"react.stockMovement.reasonCode.label\",defaultMessage:\"Reason code\",getDynamicAttr:function(e){return{options:e.reasonCodes}}},availableItems:{type:p.default,fields:{lotNumber:{type:d.default,label:\"react.stockMovement.lot.label\",defaultMessage:\"Lot\"},expirationDate:{type:d.default,label:\"react.stockMovement.expiry.label\",defaultMessage:\"Expiry\"},\"binLocation.name\":{type:d.default,label:\"react.stockMovement.binLocation.label\",defaultMessage:\"Bin Location\"},quantityAvailable:{type:d.default,label:\"react.stockMovement.quantityAvailable.label\",defaultMessage:\"Qty Available\",fixedWidth:\"150px\",attributes:{formatValue:function(e){return e?e.toLocaleString(\"en-US\"):null}}},quantityPicked:{type:f.default,label:\"react.stockMovement.quantityPicked.label\",defaultMessage:\"Qty Picked\",fixedWidth:\"140px\",attributes:{type:\"number\"}}}}};function k(e){var t={availableItems:[]};o.default.forEach(e.availableItems,function(e,a){e.quantityPicked>e.quantityAvailable&&(t.availableItems[a]={quantityPicked:\"react.stockMovement.errors.higherTyPicked.label\"}),e.quantityPicked<0&&(t.availableItems[a]={quantityPicked:\"react.stockMovement.errors.negativeQtyPicked.label\"})});var a=o.default.reduce(e.availableItems,function(e,t){return e+(t.quantityPicked?o.default.toInteger(t.quantityPicked):0)},0);return o.default.some(e.availableItems,function(e){return!o.default.isNil(e.quantityPicked)})&&!e.reasonCode&&a!==e.quantityRequired&&(t.reasonCode=\"react.stockMovement.errors.differentTotalQty.label\"),t}var S=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=e.fieldConfig,r=i.attributes,s=i.getDynamicAttr,o=s?s(e):{},l=n({},r,o);return a.state={attr:l,formValues:{}},a.onOpen=a.onOpen.bind(a),a.onSave=a.onSave.bind(a),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,r.Component),i(t,[{key:\"componentWillReceiveProps\",value:function(e){var t=e.fieldConfig,a=t.attributes,i=t.getDynamicAttr,r=i?i(e):{},s=n({},a,r);this.setState({attr:s})}},{key:\"onOpen\",value:function(){var e=this,t=o.default.map(this.state.attr.fieldValue.availableItems,function(t){var a=o.default.find(o.default.filter(e.state.attr.fieldValue.picklistItems,function(e){return!e.initial}),function(e){return e[\"inventoryItem.id\"]===t[\"inventoryItem.id\"]&&e[\"binLocation.id\"]===t[\"binLocation.id\"]});return a?n({},t,{id:a.id,quantityPicked:a.quantityPicked}):t});this.setState({formValues:{availableItems:t,reasonCode:\"\",quantityRequired:this.state.attr.fieldValue.quantityRequired}})}},{key:\"onSave\",value:function(e){var t=this;this.props.showSpinner();var a=\"/openboxes/api/stockMovementItems/\"+this.state.attr.fieldValue[\"requisitionItem.id\"]+\"/updatePicklist\",n={picklistItems:o.default.map(e.availableItems,function(t){return{id:t.id||\"\",\"inventoryItem.id\":t[\"inventoryItem.id\"],\"binLocation.id\":t[\"binLocation.id\"]||\"\",quantityPicked:o.default.isNil(t.quantityPicked)?\"\":t.quantityPicked,reasonCode:e.reasonCode||\"\"}})};return h.default.post(a,n).then(function(e){var a=e.data.data;t.state.attr.onResponse(a),t.props.hideSpinner()}).catch(function(){t.props.hideSpinner()})}},{key:\"calculatePicked\",value:function(e){return s.default.createElement(\"div\",null,s.default.createElement(\"div\",{className:\"font-weight-bold pb-2\"},s.default.createElement(v.default,{id:\"react.stockMovement.quantityPicked.label\",defaultMessage:\"Qty Picked\"}),\": \",o.default.reduce(e.availableItems,function(e,t){return e+(t.quantityPicked?o.default.toInteger(t.quantityPicked):0)},0)),s.default.createElement(\"hr\",null))}},{key:\"render\",value:function(){return this.state.attr.subfield?null:s.default.createElement(c.default,n({},this.state.attr,{onOpen:this.onOpen,onSave:this.onSave,fields:g,validate:k,initialValues:this.state.formValues,formProps:{reasonCodes:this.state.attr.reasonCodes},renderBodyWithValues:this.calculatePicked}),s.default.createElement(\"div\",null,s.default.createElement(\"div\",{className:\"font-weight-bold\"},s.default.createElement(v.default,{id:\"react.stockMovement.productCode.label\",defaultMessage:\"Product code\"}),\": \",this.state.attr.fieldValue.productCode),s.default.createElement(\"div\",{className:\"font-weight-bold\"},s.default.createElement(v.default,{id:\"react.stockMovement.productName.label\",defaultMessage:\"Product name\"}),\": \",this.state.attr.fieldValue[\"product.name\"]),s.default.createElement(\"div\",{className:\"font-weight-bold\"},s.default.createElement(v.default,{id:\"react.stockMovement.quantityRequired.label\",defaultMessage:\"Qty Required\"}),\": \",this.state.attr.fieldValue.quantityRequired)))}}]),t}();t.default=(0,u.connect)(null,{showSpinner:b.showSpinner,hideSpinner:b.hideSpinner})(S),S.propTypes={fieldName:l.default.string.isRequired,fieldConfig:l.default.shape({getDynamicAttr:l.default.func}).isRequired,showSpinner:l.default.func.isRequired,hideSpinner:l.default.func.isRequired}},539:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=w(a(13)),s=a(1),o=w(s),l=a(25),u=a(253),c=w(a(264)),d=w(a(0)),f=w(a(53)),p=w(a(267)),m=a(89),h=a(14);a(256);var b=w(a(257)),v=w(a(254)),y=a(250),g=w(a(261)),k=w(a(255)),S=a(12),M=w(S),I=a(52),E=w(a(540)),q=a(92),P=a(88),x=w(P);function w(e){return e&&e.__esModule?e:{default:e}}var C={packPageItems:{type:b.default,virtualized:!0,fields:{productCode:{type:g.default,flexWidth:\"0.7\",label:\"react.stockMovement.code.label\",defaultMessage:\"Code\"},productName:{type:g.default,label:\"react.stockMovement.productName.label\",defaultMessage:\"Product Name\",flexWidth:\"3\",attributes:{className:\"text-left ml-1\"}},binLocationName:{type:g.default,label:\"react.stockMovement.binLocation.label\",defaultMessage:\"Bin location\",flexWidth:\"1\"},lotNumber:{type:g.default,label:\"react.stockMovement.lot.label\",defaultMessage:\"Lot\",flexWidth:\"1\"},expirationDate:{type:g.default,label:\"react.stockMovement.expiry.label\",defaultMessage:\"Expiry\",flexWidth:\"1\"},quantityShipped:{type:g.default,label:\"react.stockMovement.quantityShipped.label\",defaultMessage:\"Qty shipped\",flexWidth:\"0.8\"},uom:{type:g.default,label:\"react.stockMovement.uom.label\",defaultMessage:\"UoM\",flexWidth:\"0.8\"},recipient:{type:k.default,label:\"react.stockMovement.recipient.label\",defaultMessage:\"Recipient\",flexWidth:\"2.5\",fieldKey:\"\",attributes:{async:!0,required:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],labelKey:\"name\",filterOptions:function(e){return e}},getDynamicAttr:function(e){return{loadOptions:e.debouncedUsersFetch}}},palletName:{type:v.default,label:\"react.stockMovement.pallet.label\",defaultMessage:\"Pallet\",flexWidth:\"0.8\"},boxName:{type:v.default,label:\"react.stockMovement.box.label\",defaultMessage:\"Box\",flexWidth:\"0.8\"},splitLineItems:{type:E.default,label:\"react.stockMovement.splitLine.label\",defaultMessage:\"Split line\",flexWidth:\"1\",fieldKey:\"\",attributes:{title:\"react.stockMovement.splitLine.label\",btnOpenText:\"react.stockMovement.splitLine.label\",btnOpenDefaultText:\"Split line\",btnOpenClassName:\"btn btn-outline-success\"},getDynamicAttr:function(e){var t=e.fieldValue,a=e.rowIndex,n=e.onSave,i=e.formValues;return{lineItem:t,onSave:function(e){return n(i,a,e)}}}}}}},R=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.dataFetched=!1,a.state={values:n({},a.props.initialValues,{packPageItems:[]})},a.saveSplitLines=a.saveSplitLines.bind(a),a.debouncedUsersFetch=(0,q.debounceUsersFetch)(a.props.debounceTime,a.props.minSearchLength),a.props.showSpinner(),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),i(t,[{key:\"componentDidMount\",value:function(){this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchAllData())}},{key:\"componentWillReceiveProps\",value:function(e){e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchAllData())}},{key:\"fetchAllData\",value:function(){var e=this;this.fetchLineItems().then(function(t){var a=t.data.data.packPage.packPageItems;e.setState({values:n({},e.state.values,{packPageItems:a})}),e.props.hideSpinner()}).catch(function(){e.props.hideSpinner()})}},{key:\"save\",value:function(e){var t=this;this.props.showSpinner(),this.savePackingData(e.packPageItems).then(function(e){var a=e.data.data.packPage.packPageItems;t.setState({values:n({},t.state.values,{packPageItems:a})}),t.props.hideSpinner(),f.default.success(t.props.translate(\"react.stockMovement.alert.saveSuccess.label\",\"Changes saved successfully\"),{timeout:3e3})}).catch(function(){return t.props.hideSpinner()})}},{key:\"refresh\",value:function(){var e=this;(0,m.confirmAlert)({title:this.props.translate(\"react.stockMovement.message.confirmRefresh.label\",\"Confirm refresh\"),message:this.props.translate(\"react.stockMovement.confirmRefresh.message\",\"Are you sure you want to refresh? Your progress since last save will be lost.\"),buttons:[{label:this.props.translate(\"react.default.yes.label\",\"Yes\"),onClick:function(){return e.fetchAllData()}},{label:this.props.translate(\"react.default.no.label\",\"No\")}]})}},{key:\"transitionToNextStep\",value:function(){var e=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/status\";return M.default.post(e,{status:\"CHECKING\"})}},{key:\"fetchLineItems\",value:function(){var e=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"?stepNumber=5\";return M.default.get(e).then(function(e){return e}).catch(function(e){return e})}},{key:\"nextPage\",value:function(e){var t=this;this.props.showSpinner(),this.savePackingData(e.packPageItems).then(function(){t.transitionToNextStep().then(function(){t.props.hideSpinner(),t.props.onSubmit(e)}).catch(function(){return t.props.hideSpinner()})}).catch(function(){return t.props.hideSpinner()})}},{key:\"savePackingData\",value:function(e){var t=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/updateShipmentItems\",a={id:this.state.values.stockMovementId,stepNumber:\"5\",packPageItems:e};return a.packPageItems.length?M.default.post(t,(0,S.flattenRequest)(a)).catch(function(){return Promise.reject(new Error(\"react.stockMovement.error.saveRequisitionItems.label\"))}):Promise.resolve()}},{key:\"saveSplitLines\",value:function(e,t,a){var i=this;this.props.showSpinner(),this.savePackingData((0,p.default)(e.packPageItems,function(e,t,a){return t in e?Object.defineProperty(e,t,{value:a,enumerable:!0,configurable:!0,writable:!0}):e[t]=a,e}({},t,{splitLineItems:{$set:a}}))).then(function(e){var t=e.data.data.packPage.packPageItems;i.setState({values:n({},i.state.values,{packPageItems:t})}),i.props.hideSpinner()}).catch(function(){return i.props.hideSpinner()})}},{key:\"render\",value:function(){var e=this;return o.default.createElement(u.Form,{onSubmit:function(t){return e.nextPage(t)},mutators:n({},c.default),initialValues:this.state.values,render:function(t){var a=t.handleSubmit,n=t.values,i=t.invalid;return o.default.createElement(\"div\",{className:\"d-flex flex-column\"},o.default.createElement(\"span\",null,o.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.refresh()},className:\"float-right mb-1 btn btn-outline-secondary align-self-end ml-1 btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-refresh pr-2\"}),o.default.createElement(x.default,{id:\"react.default.button.refresh.label\",defaultMessage:\"Reload\"}))),o.default.createElement(\"button\",{type:\"button\",disabled:i,onClick:function(){return e.save(n)},className:\"float-right mb-1 btn btn-outline-secondary align-self-end btn-xs ml-1\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-save pr-2\"}),o.default.createElement(x.default,{id:\"react.default.button.save.label\",defaultMessage:\"Save\"}))),o.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.savePackingData(n.packPageItems).then(function(){window.location=\"/openboxes/stockMovement/show/\"+n.stockMovementId})},className:\"float-right mb-1 btn btn-outline-secondary align-self-end btn-xs\"},o.default.createElement(\"span\",null,o.default.createElement(\"i\",{className:\"fa fa-sign-out pr-2\"}),o.default.createElement(x.default,{id:\"react.default.button.saveAndExit.label\",defaultMessage:\"Save and exit\"})))),o.default.createElement(\"form\",{onSubmit:a},r.default.map(C,function(t,a){return(0,y.renderFormField)(t,a,{onSave:e.saveSplitLines,formValues:n,debouncedUsersFetch:e.debouncedUsersFetch})}),o.default.createElement(\"div\",null,o.default.createElement(\"button\",{type:\"button\",className:\"btn btn-outline-primary btn-form btn-xs\",onClick:function(){return e.savePackingData(n.packPageItems).then(function(){return e.props.previousPage(n)})}},o.default.createElement(x.default,{id:\"react.default.button.previous.label\",defaultMessage:\"Previous\"})),o.default.createElement(\"button\",{type:\"submit\",className:\"btn btn-outline-primary btn-form float-right btn-xs\"},o.default.createElement(x.default,{id:\"react.default.button.next.label\",defaultMessage:\"Next\"})))))}})}}]),t}();t.default=(0,l.connect)(function(e){return{recipients:e.users.data,recipientsFetched:e.users.fetched,translate:(0,P.translateWithDefaultMessage)((0,h.getTranslate)(e.localize)),stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement,debounceTime:e.session.searchConfig.debounceTime,minSearchLength:e.session.searchConfig.minSearchLength}},{showSpinner:I.showSpinner,hideSpinner:I.hideSpinner})(R),R.propTypes={initialValues:d.default.shape({}).isRequired,previousPage:d.default.func.isRequired,onSubmit:d.default.func.isRequired,showSpinner:d.default.func.isRequired,hideSpinner:d.default.func.isRequired,translate:d.default.func.isRequired,stockMovementTranslationsFetched:d.default.bool.isRequired,debounceTime:d.default.number.isRequired,minSearchLength:d.default.number.isRequired}},540:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),r=y(a(13)),s=a(1),o=y(s),l=y(a(0)),u=a(25),c=y(a(274)),d=y(a(254)),f=y(a(257)),p=y(a(261)),m=y(a(255)),h=a(52),b=a(92),v=y(a(88));function y(e){return e&&e.__esModule?e:{default:e}}var g={splitLineItems:{addButton:function(e){var t=e.addRow,a=e.lineItem;return o.default.createElement(\"button\",{type:\"button\",className:\"btn btn-outline-success btn-xs\",onClick:function(){return t({productName:a.productName,lotNumber:a.lotNumber,expirationDate:a.expirationDate,binLocationName:a.binLocationName,recipient:a.recipient})}},\" \",o.default.createElement(v.default,{id:\"react.default.button.addLine.label\",defaultMessage:\"Add line\"}))},type:f.default,fields:{productName:{type:p.default,label:\"react.stockMovement.productName.label\",defaultMessage:\"Product name\"},lotNumber:{type:p.default,label:\"react.stockMovement.lot.label\",defaultMessage:\"Lot\"},expirationDate:{type:p.default,label:\"react.stockMovement.expiry.label\",defaultMessage:\"Expiry\"},binLocationName:{type:p.default,label:\"react.stockMovement.binLocation.label\",defaultMessage:\"Bin Location\"},quantityShipped:{type:d.default,label:\"react.stockMovement.quantityShipped.label\",defaultMessage:\"Quantity shipped\",fixedWidth:\"150px\",attributes:{type:\"number\"}},recipient:{type:m.default,label:\"react.stockMovement.recipient.label\",defaultMessage:\"Recipient\",fieldKey:\"\",attributes:{async:!0,required:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,cache:!1,options:[],labelKey:\"name\",filterOptions:function(e){return e}},getDynamicAttr:function(e){return{loadOptions:e.debouncedUsersFetch}}},palletName:{type:d.default,label:\"react.stockMovement.pallet.label\",defaultMessage:\"Pallet\",fixedWidth:\"150px\"},boxName:{type:d.default,label:\"react.stockMovement.box.label\",defaultMessage:\"Box\",fixedWidth:\"150px\"}}}},k=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e)),i=e.fieldConfig,r=i.attributes,s=i.getDynamicAttr,o=s?s(e):{},l=n({},r,o);return a.state={attr:l,formValues:{}},a.onOpen=a.onOpen.bind(a),a.validate=a.validate.bind(a),a.debouncedUsersFetch=(0,b.debounceUsersFetch)(a.props.debounceTime,a.props.minSearchLength),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,s.Component),i(t,null,[{key:\"calculatePacked\",value:function(e){return r.default.reduce(e,function(e,t){return e+(t.quantityShipped?r.default.toInteger(t.quantityShipped):0)},0)}},{key:\"displayPackedSum\",value:function(e){return o.default.createElement(\"div\",null,o.default.createElement(\"div\",{className:\"font-weight-bold pb-2\"},o.default.createElement(v.default,{id:\"react.stockMovement.quantityPacked.label\",defaultMessage:\"Qty Packed\"}),\": \",t.calculatePacked(e.splitLineItems)),o.default.createElement(\"hr\",null))}}]),i(t,[{key:\"componentWillReceiveProps\",value:function(e){var t=e.fieldConfig,a=t.attributes,i=t.getDynamicAttr,r=i?i(e):{},s=n({},a,r);this.setState({attr:s})}},{key:\"onOpen\",value:function(){this.setState({formValues:{splitLineItems:[{productName:this.state.attr.lineItem.productName,lotNumber:this.state.attr.lineItem.lotNumber,expirationDate:this.state.attr.lineItem.expirationDate,binLocationName:this.state.attr.lineItem.binLocationName,quantityShipped:this.state.attr.lineItem.quantityShipped,recipient:this.state.attr.lineItem.recipient,palletName:this.state.attr.lineItem.palletName,boxName:this.state.attr.lineItem.boxName}]}})}},{key:\"validate\",value:function(e){var a=r.default.toInteger(this.state.attr.lineItem.quantityShipped),n=t.calculatePacked(e.splitLineItems),i={splitLineItems:[]};return r.default.forEach(e.splitLineItems,function(e,t){a!==n&&(i.splitLineItems[t]={quantityShipped:\"react.stockMovement.errors.packingQty.label\"}),e.quantityShipped<0&&(i.splitLineItems[t]={quantityShipped:\"react.stockMovement.errors.negativeQtyShipped.label\"})}),i}},{key:\"render\",value:function(){var e=this;return o.default.createElement(c.default,n({},this.state.attr,{onOpen:this.onOpen,onSave:function(t){return e.state.attr.onSave(r.default.filter(t.splitLineItems,function(e){return e.quantityShipped}))},fields:g,initialValues:this.state.formValues,formProps:{lineItem:this.state.attr.lineItem,debouncedUsersFetch:this.debouncedUsersFetch},validate:this.validate,renderBodyWithValues:t.displayPackedSum}),o.default.createElement(\"div\",null,o.default.createElement(\"div\",{className:\"font-weight-bold\"},o.default.createElement(v.default,{id:\"react.stockMovement.totalQuantity.label\",defaultMessage:\"Total quantity\"}),\": \",this.state.attr.lineItem.quantityShipped)))}}]),t}();t.default=(0,u.connect)(function(e){return{debounceTime:e.session.searchConfig.debounceTime,minSearchLength:e.session.searchConfig.minSearchLength}},{showSpinner:h.showSpinner,hideSpinner:h.hideSpinner})(k),k.propTypes={fieldName:l.default.string.isRequired,fieldConfig:l.default.shape({getDynamicAttr:l.default.func}).isRequired,showSpinner:l.default.func.isRequired,hideSpinner:l.default.func.isRequired,debounceTime:l.default.number.isRequired,minSearchLength:l.default.number.isRequired}},541:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var a=arguments[t];for(var n in a)Object.prototype.hasOwnProperty.call(a,n)&&(e[n]=a[n])}return e},i=function(){return function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var a=[],n=!0,i=!1,r=void 0;try{for(var s,o=e[Symbol.iterator]();!(n=(s=o.next()).done)&&(a.push(s.value),!t||a.length!==t);n=!0);}catch(e){i=!0,r=e}finally{try{!n&&o.return&&o.return()}finally{if(i)throw r}}return a}(e,t);throw new TypeError(\"Invalid attempt to destructure non-iterable instance\")}}(),r=function(){function e(e,t){for(var a=0;a<t.length;a++){var n=t[a];n.enumerable=n.enumerable||!1,n.configurable=!0,\"value\"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,a,n){return a&&e(t.prototype,a),n&&e(t,n),t}}(),s=w(a(13)),o=a(1),l=w(o),u=a(25),c=w(a(0)),d=w(a(558)),f=w(a(53)),p=a(253),m=w(a(264)),h=a(14),b=a(89);a(256);var v=a(250),y=a(52),g=w(a(12)),k=w(a(275)),S=w(a(543)),M=w(a(255)),I=w(a(254)),E=w(a(261)),q=a(92),P=a(88),x=w(P);function w(e){return e&&e.__esModule?e:{default:e}}var C={description:{label:\"react.stockMovement.description.label\",defaultMessage:\"Description\",type:function(e){return e.issued?l.default.createElement(I.default,e):l.default.createElement(E.default,e)}},\"origin.name\":{label:\"react.stockMovement.origin.label\",defaultMessage:\"Origin\",type:E.default},destination:{label:\"react.stockMovement.destination.label\",defaultMessage:\"Destination\",fieldKey:\"\",type:function(e){return e.canBeEdited&&!e.hasStockList?l.default.createElement(M.default,e):l.default.createElement(E.default,e)},getDynamicAttr:function(e){var t=e.canBeEdited,a=e.hasStockList,n=e.debouncedLocationsFetch;return t&&!a?{required:!0,async:!0,showValueTooltip:!0,openOnClick:!1,autoload:!1,loadOptions:n,cache:!1,options:[],filterOptions:function(e){return e}}:{formatValue:function(e){return s.default.get(e,\"name\")}}}},\"stocklist.name\":{label:\"react.stockMovement.stocklist.label\",defaultMessage:\"Stocklist\",type:E.default},\"requestedBy.name\":{label:\"react.stockMovement.requestedBy.label\",defaultMessage:\"Requested by\",type:E.default},dateRequested:{label:\"react.stockMovement.dateRequested.label\",defaultMessage:\"Date requested\",type:E.default},name:{label:\"react.stockMovement.shipmentName.label\",defaultMessage:\"Shipment name\",type:E.default}},R={dateShipped:{type:k.default,label:\"react.stockMovement.shipDate.label\",defaultMessage:\"Shipment date\",attributes:{dateFormat:\"MM/DD/YYYY HH:mm Z\",required:!0,showTimeSelect:!0,autoComplete:\"off\"},getDynamicAttr:function(e){return{disabled:e.issued}}},shipmentType:{type:M.default,label:\"react.stockMovement.shipmentType.label\",defaultMessage:\"Shipment type\",attributes:{required:!0,showValueTooltip:!0},getDynamicAttr:function(e){return{options:e.shipmentTypes}}},trackingNumber:{type:I.default,label:\"react.stockMovement.trackingNumber.label\",defaultMessage:\"Tracking number\",getDynamicAttr:function(e){return{disabled:e.issued}}},driverName:{type:I.default,label:\"react.stockMovement.driverName.label\",defaultMessage:\"Driver name\",getDynamicAttr:function(e){return{disabled:e.issued}}},comments:{type:I.default,label:\"react.stockMovement.comments.label\",defaultMessage:\"Comments\",getDynamicAttr:function(e){return{disabled:e.issued}}}};function N(e){var t={};return e.dateShipped||(t.dateShipped=\"react.default.error.requiredField.label\"),e.shipmentType||(t.shipmentType=\"react.default.error.requiredField.label\"),t}var T=function(e){function t(e){!function(e,t){if(!(e instanceof t))throw new TypeError(\"Cannot call a class as a function\")}(this,t);var a=function(e,t){if(!e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return!t||\"object\"!=typeof t&&\"function\"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e));return a.logopath=null,a.dataFetched=!1,a.state={shipmentTypes:[],tableItems:[],supplier:!1,documents:[],files:[],values:a.props.initialValues},a.props.showSpinner(),a.onDrop=a.onDrop.bind(a),a.debouncedLocationsFetch=(0,q.debounceLocationsFetch)(a.props.debounceTime,a.props.minSearchLength),a}return function(e,t){if(\"function\"!=typeof t&&null!==t)throw new TypeError(\"Super expression must either be null or a function, not \"+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,o.Component),r(t,[{key:\"componentDidMount\",value:function(){this.props.showSpinner(),this.props.stockMovementTranslationsFetched&&(this.dataFetched=!0,this.fetchShipmentTypes(),this.fetchStockMovementData())}},{key:\"componentWillReceiveProps\",value:function(e){e.stockMovementTranslationsFetched&&!this.dataFetched&&(this.dataFetched=!0,this.fetchShipmentTypes(),this.fetchStockMovementData())}},{key:\"onDrop\",value:function(e){var t=this.state.files,a=s.default.differenceBy(t,e,\"name\");this.setState({files:s.default.concat(a,e)})}},{key:\"onSave\",value:function(e){var t=this;this.props.showSpinner(),this.saveValues(e).then(function(){t.props.hideSpinner(),\"ISSUED\"===e.statusCode&&t.fetchStockMovementData(),f.default.success(t.props.translate(\"react.stockMovement.alert.saveSuccess.label\",\"Changes saved successfully\"),{timeout:3e3})}).catch(function(){return t.props.hideSpinner()})}},{key:\"saveValues\",value:function(e){var t={dateShipped:e.dateShipped,\"shipmentType.id\":e.shipmentType,trackingNumber:e.trackingNumber||\"\",driverName:e.driverName||\"\",comments:e.comments||\"\"};return\"ISSUED\"===e.statusCode&&(t={\"destination.id\":e.destination.id,description:e.description,\"shipmentType.id\":e.shipmentType}),this.saveShipment(t)}},{key:\"removeFile\",value:function(e){var t=this.state.files;s.default.remove(t,function(t){return t.name===e}),this.setState({files:t})}},{key:\"fetchShipmentTypes\",value:function(){var e=this;return g.default.get(\"/openboxes/api/generic/shipmentType\").then(function(t){var a=s.default.map(t.data.data,function(t){var a=s.default.split(t.name,\"|fr:\"),n=i(a,2),r=n[0],o=n[1];return{value:t.id,label:\"fr\"===e.props.locale&&o?o:r}});e.setState({shipmentTypes:a},function(){return e.props.hideSpinner()})}).catch(function(){return e.props.hideSpinner()})}},{key:\"fetchStockMovementData\",value:function(){var e=this,t=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"?stepNumber=6\";return g.default.get(t).then(function(t){var a=t.data.data,i=t.data.data.associations,r=void 0,o=void 0;!s.default.isEmpty(a)&&a.packPage&&a.packPage.packPageItems.length?(r=a.packPage.packPageItems,o=!1):(r=a.lineItems,o=!0);var l=s.default.filter(i.documents,function(e){return 5===e.stepNumber}),u=a.destination.locationType;e.setState({tableItems:r,supplier:o,documents:l,values:n({},e.state.values,{dateShipped:a.dateShipped,shipmentType:s.default.get(a,\"shipmentType.id\"),trackingNumber:a.trackingNumber,driverName:a.driverName,comments:a.comments,name:a.name,description:a.description,destination:{id:a.destination.id,type:u?u.locationTypeCode:null,name:a.destination.name,label:a.destination.name+\"\\n                [\"+(u?u.description:null)+\"]\"}})},function(){e.props.setValues(e.state.values),e.props.hideSpinner()})}).catch(function(){return e.props.hideSpinner()})}},{key:\"sendFile\",value:function(e){var t=\"/openboxes/stockMovement/uploadDocument/\"+this.state.values.stockMovementId,a=new FormData;return a.append(\"fileContents\",e),g.default.post(t,a)}},{key:\"saveShipment\",value:function(e){var t=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/updateShipment\";return g.default.post(t,e)}},{key:\"stateTransitionToIssued\",value:function(){var e=\"/openboxes/api/stockMovements/\"+this.state.values.stockMovementId+\"/status\";return g.default.post(e,{status:\"ISSUED\"})}},{key:\"submitStockMovement\",value:function(e){var t=this;this.props.showSpinner(),this.state.files.length&&s.default.forEach(this.state.files,function(e){t.sendFile(e).then(function(){return f.default.success(t.props.translate(\"react.stockMovement.alert.fileSuccess.label\",\"File uploaded successfuly!\"),{timeout:3e3})}).catch(function(){return f.default.error(t.props.translate(\"react.stockMovement.alert.fileError.label\",\"Error occured during file upload!\"))})});var a={dateShipped:e.dateShipped,\"shipmentType.id\":e.shipmentType,trackingNumber:e.trackingNumber||\"\",driverName:e.driverName||\"\",comments:e.comments||\"\"};this.props.currentLocationId!==e.origin.id&&\"SUPPLIER\"!==e.origin.type?(f.default.error(this.props.translate(\"react.stockMovement.alert.sendStockMovement.label\",\"You are not able to send shipment from a location other than origin. Change your current location.\")),this.props.hideSpinner()):e.shipmentType===s.default.find(this.state.shipmentTypes,function(e){return\"Default\"===e.label}).value?(f.default.error(this.props.translate(\"react.stockMovement.alert.populateShipmentType.label\",\"Please populate shipment type before continuing\")),this.props.hideSpinner()):this.saveShipment(a).then(function(){t.stateTransitionToIssued().then(function(){window.location=\"/openboxes/stockMovement/show/\"+t.state.values.stockMovementId}).catch(function(){return t.props.hideSpinner()})}).catch(function(){return t.props.hideSpinner()})}},{key:\"previousPage\",value:function(e,t){var a=this;t?(0,b.confirmAlert)({title:this.props.translate(\"react.stockMovement.confirmPreviousPage.label\",\"Validation error\"),message:this.props.translate(\"react.stockMovement.confirmPreviousPage.message.label\",\"Cannot save due to validation error on page\"),buttons:[{label:this.props.translate(\"react.stockMovement.confirmPreviousPage.correctError.label\",\"Correct error\")},{label:this.props.translate(\"react.stockMovement.confirmPreviousPage.continue.label\",\"Continue (lose unsaved work)\"),onClick:function(){return a.props.previousPage(e)}}]}):this.saveValues(e).then(function(){return a.props.previousPage(e)})}},{key:\"saveAndExit\",value:function(e){var t=N(e);s.default.isEmpty(t)?this.saveValues(e).then(function(){window.location=\"/openboxes/stockMovement/show/\"+e.stockMovementId}):(0,b.confirmAlert)({title:this.props.translate(\"react.stockMovement.confirmExit.label\",\"Confirm save\"),message:this.props.translate(\"react.stockMovement.confirmExit.message\",\"Validation errors occurred. Are you sure you want to exit and lose unsaved data?\"),buttons:[{label:this.props.translate(\"react.default.yes.label\",\"Yes\"),onClick:function(){window.location=\"/openboxes/stockMovement/show/\"+e.stockMovementId}},{label:this.props.translate(\"react.default.no.label\",\"No\")}]})}},{key:\"render\",value:function(){var e=this;return l.default.createElement(\"div\",null,l.default.createElement(\"hr\",null),l.default.createElement(p.Form,{onSubmit:function(){},validate:N,mutators:n({},m.default),initialValues:this.state.values,render:function(t){var a=t.handleSubmit,i=t.values,r=t.invalid;return l.default.createElement(\"form\",{onSubmit:a},l.default.createElement(\"div\",{className:\"d-flex\"},l.default.createElement(\"div\",{id:\"stockMovementInfo\",style:{flexGrow:2}},s.default.map(C,function(t,a){return(0,v.renderFormField)(t,a,{canBeEdited:\"ISSUED\"===i.statusCode&&\"PARTIALLY_RECEIVED\"!==i.shipmentStatus&&\"RECEIVED\"!==i.shipmentStatus,issued:\"ISSUED\"===i.statusCode,hasStockList:!!s.default.get(i.stocklist,\"id\"),debouncedLocationsFetch:e.debouncedLocationsFetch})})),l.default.createElement(\"div\",{className:\"print-buttons-container col-md-3 flex-grow-1\"},e.state.documents.length&&s.default.map(e.state.documents,function(t,a){return console.log(t),t.hidden?null:(t.contentType.includes(\"pdf\")?e.logopath=\"/images/icons/pdf.png\":t.contentType.includes(\"ms-excel\")?e.logopath=\"/images/icons/silk/page_white_excel.png\":t.contentType.includes(\"html\")&&(e.logopath=\"/images/icons/silk/html_go.png\"),l.default.createElement(S.default,n({link:t.uri,logo:e.logopath,buttonTitle:t.name},t,{key:a})))}),l.default.createElement(\"div\",{className:\"dropzone btn btn-outline-secondary\"},l.default.createElement(d.default,{disabled:\"ISSUED\"===i.statusCode,onDrop:e.onDrop,multiple:!0},l.default.createElement(\"span\",null,l.default.createElement(\"i\",{className:\"fa fa-upload pr-2\"}),\"Upload Documents\"),s.default.map(e.state.files,function(t){return l.default.createElement(\"div\",{key:t.name,className:\"chosen-file d-flex justify-content-center align-items-center\"},l.default.createElement(\"div\",{className:\"text-truncate\"},t.name),l.default.createElement(\"a\",{href:\"#\",className:\"remove-button\",onClick:function(a){e.removeFile(t.name),a.stopPropagation()}},l.default.createElement(\"span\",{className:\"fa fa-remove\"})))}))))),l.default.createElement(\"hr\",null),l.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.onSave(i)},className:\"btn btn-outline-secondary float-right btn-form btn-xs\",disabled:r},l.default.createElement(\"span\",null,l.default.createElement(\"i\",{className:\"fa fa-save pr-2\"}),l.default.createElement(x.default,{id:\"react.default.button.save.label\",defaultMessage:\"Save\"}))),l.default.createElement(\"button\",{type:\"button\",onClick:function(){return e.saveAndExit(i)},className:\"float-right mb-1 btn btn-outline-secondary align-self-end btn-xs\"},l.default.createElement(\"span\",null,l.default.createElement(\"i\",{className:\"fa fa-sign-out pr-2\"}),l.default.createElement(x.default,{id:\"react.default.button.saveAndExit.label\",defaultMessage:\"Save and exit\"}))),l.default.createElement(\"div\",{className:\"col-md-9 pl-0\"},s.default.map(R,function(t,a){return(0,v.renderFormField)(t,a,{shipmentTypes:e.state.shipmentTypes,issued:\"ISSUED\"===i.statusCode})})),l.default.createElement(\"div\",null,l.default.createElement(\"button\",{type:\"submit\",className:\"btn btn-outline-primary btn-form btn-xs\",disabled:\"ISSUED\"===i.statusCode,onClick:function(){return e.previousPage(i,r)}},l.default.createElement(x.default,{id:\"react.default.button.previous.label\",defaultMessage:\"Previous\"})),l.default.createElement(\"button\",{type:\"submit\",onClick:function(){e.submitStockMovement(i)},className:\"btn btn-outline-success float-right btn-form btn-xs\",disabled:r||\"ISSUED\"===i.statusCode},l.default.createElement(x.default,{id:\"react.stockMovement.sendShipment.label\",defaultMessage:\"Send shipment\"})),l.default.createElement(\"table\",{className:\"table table-striped text-center border my-2 table-xs\"},l.default.createElement(\"thead\",null,l.default.createElement(\"tr\",null,l.default.createElement(\"th\",null,l.default.createElement(x.default,{id:\"react.stockMovement.pallet.label\",defaultMessage:\"Pallet\"}),\" \"),l.default.createElement(\"th\",null,l.default.createElement(x.default,{id:\"react.stockMovement.box.label\",defaultMessage:\"Box\"}),\" \"),l.default.createElement(\"th\",null,l.default.createElement(x.default,{id:\"react.stockMovement.code.label\",defaultMessage:\"Code\"}),\" \"),l.default.createElement(\"th\",null,l.default.createElement(x.default,{id:\"react.stockMovement.productName.label\",defaultMessage:\"Product name\"}),\" \"),l.default.createElement(\"th\",null,l.default.createElement(x.default,{id:\"react.stockMovement.lot.label\",defaultMessage:\"Lot\"}),\" \"),l.default.createElement(\"th\",null,l.default.createElement(x.default,{id:\"react.stockMovement.expiry.label\",defaultMessage:\"Expiry\"}),\" \"),l.default.createElement(\"th\",{style:{width:\"150px\"}},l.default.createElement(x.default,{id:\"react.stockMovement.quantityPicked.label\",defaultMessage:\"Qty Picked\"}),\" \"),!e.state.supplier&&l.default.createElement(\"th\",null,l.default.createElement(x.default,{id:\"react.stockMovement.binLocation.label\",defaultMessage:\"Bin Location\"}),\" \"),l.default.createElement(\"th\",null,l.default.createElement(x.default,{id:\"react.stockMovement.recipient.label\",defaultMessage:\"Recipient\"}),\" \"))),l.default.createElement(\"tbody\",null,s.default.map(e.state.tableItems,function(t,a){return l.default.createElement(\"tr\",{key:a},l.default.createElement(\"td\",null,t.palletName),l.default.createElement(\"td\",null,t.boxName),l.default.createElement(\"td\",null,t.productCode||t.product.productCode),l.default.createElement(\"td\",{className:\"text-left\"},l.default.createElement(\"span\",{className:\"ml-4\"},t.productName||t.product.name)),l.default.createElement(\"td\",null,t.lotNumber),l.default.createElement(\"td\",null,t.expirationDate),l.default.createElement(\"td\",{style:{width:\"150px\"}},(t.quantityShipped?t.quantityShipped.toLocaleString(\"en-US\"):t.quantityShipped)||(t.quantityRequested?t.quantityRequested.toLocaleString(\"en-US\"):t.quantityRequested)),!e.state.supplier&&l.default.createElement(\"td\",null,t.binLocationName),l.default.createElement(\"td\",null,t.recipient?t.recipient.name:null))}))),l.default.createElement(\"button\",{type:\"submit\",className:\"btn btn-outline-primary btn-form btn-xs\",disabled:\"ISSUED\"===i.statusCode,onClick:function(){return e.previousPage(i,r)}},\" \",l.default.createElement(x.default,{id:\"react.default.button.previous.label\",defaultMessage:\"Previous\"})),l.default.createElement(\"button\",{type:\"submit\",onClick:function(){e.submitStockMovement(i)},className:\"btn btn-outline-success float-right btn-form btn-xs\",disabled:r||\"ISSUED\"===i.statusCode},l.default.createElement(x.default,{id:\"react.stockMovement.sendShipment.label\",defaultMessage:\"Send shipment\"}))))}}))}}]),t}();t.default=(0,u.connect)(function(e){return{translate:(0,P.translateWithDefaultMessage)((0,h.getTranslate)(e.localize)),currentLocationId:e.session.currentLocation.id,stockMovementTranslationsFetched:e.session.fetchedTranslations.stockMovement,debounceTime:e.session.searchConfig.debounceTime,minSearchLength:e.session.searchConfig.minSearchLength,locale:e.session.activeLanguage}},{showSpinner:y.showSpinner,hideSpinner:y.hideSpinner})(T),T.propTypes={initialValues:c.default.shape({}).isRequired,previousPage:c.default.func.isRequired,showSpinner:c.default.func.isRequired,hideSpinner:c.default.func.isRequired,setValues:c.default.func.isRequired,translate:c.default.func.isRequired,currentLocationId:c.default.string.isRequired,stockMovementTranslationsFetched:c.default.bool.isRequired,debounceTime:c.default.number.isRequired,minSearchLength:c.default.number.isRequired,locale:c.default.string.isRequired}},543:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=r(a(1)),i=r(a(0));function r(e){return e&&e.__esModule?e:{default:e}}var s=function(e){var t=e.buttonIcon,a=e.buttonTitle,i=e.link,r=e.logo,s=e.target;return n.default.createElement(\"a\",{href:i,className:\"py-1 mb-1 btn btn-outline-secondary\",target:s,rel:\"noopener noreferrer\"},n.default.createElement(\"span\",null,n.default.createElement(\"i\",{className:\"pr-2 fa \"+t}),a,\" \",n.default.createElement(\"img\",{src:r,alt:r}),\" \"))};t.default=s,s.propTypes={buttonIcon:i.default.string,buttonTitle:i.default.string,link:i.default.string.isRequired,target:i.default.string,logo:i.default.string},s.defaultProps={buttonIcon:\"fa-download\",buttonTitle:\"Print Document\",target:\"_blank\",logo:\"\"}},544:function(e,t,a){\"use strict\";Object.defineProperty(t,\"__esModule\",{value:!0});var n=s(a(1)),i=s(a(0)),r=s(a(13));function s(e){return e&&e.__esModule?e:{default:e}}var o=function(e){return n.default.createElement(\"div\",{className:\"wizard-box container-fluid d-print-none\"},n.default.createElement(\"div\",{className:\"row\"},n.default.createElement(\"div\",{className:\"wizard-steps d-flex flex-wrap\"},r.default.map(e.steps,function(t,a){return n.default.createElement(\"div\",{key:a,className:\"\\n              \"+(a+1===e.currentStep?\"active-step\":\"\")+\" \\n              \"+(a+1<e.currentStep?\"completed-step\":\"\")+\" \\n              \"+(a+1>e.currentStep||!e.stepsClickable?\"disabled-step \":\"\")},n.default.createElement(\"a\",{href:\"#\",onClick:function(){return e.onClick(a+1)}},t))}))))};t.default=o,o.propTypes={steps:i.default.arrayOf(i.default.string).isRequired,currentStep:i.default.number.isRequired,onClick:i.default.func,stepsClickable:i.default.bool},o.defaultProps={onClick:function(e){return e},stepsClickable:!1}}}]);","extractedComments":[]}